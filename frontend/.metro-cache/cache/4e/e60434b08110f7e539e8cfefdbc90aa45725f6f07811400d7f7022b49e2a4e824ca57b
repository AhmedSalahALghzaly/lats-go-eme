{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":29,"index":44},"end":{"line":3,"column":84,"index":99}}],"key":"kslwqCIsh6ew+I1KeA1rlVRjsAk=","exportNames":["*"],"imports":1}},{"name":"../utils/common/randomId","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":8,"column":39,"index":278},"end":{"line":8,"column":74,"index":313}}],"key":"5prJ5zgoK/519n3OgQgOvolJ+eo=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  exports.__esModule = true;\n  exports.nullValue = nullValue;\n  exports.sanitizedRaw = sanitizedRaw;\n  exports.setRawSanitized = setRawSanitized;\n  var _randomId = _interopRequireDefault(require(_dependencyMap[1], \"../utils/common/randomId\"));\n  /* eslint-disable no-lonely-if */\n  /* eslint-disable no-self-compare */\n  // Raw object representing a model record, coming from an untrusted source\n  // (disk, sync, user data). Before it can be used to create a Model instance\n  // it must be sanitized (with `sanitizedRaw`) into a RawRecord\n  // These fields are ALWAYS present in records of any collection.\n  // Raw object representing a model record. A RawRecord is guaranteed by the type system\n  // to be safe to use (sanitied with `sanitizedRaw`):\n  // - it has exactly the fields described by TableSchema (+ standard fields)\n  // - every field is exactly the type described by ColumnSchema (string, number, or boolean)\n  // - … and the same optionality (will not be null unless isOptional: true)\n  // a number, but not NaN (NaN !== NaN) or Infinity\n  function isValidNumber(value) {\n    return 'number' === typeof value && value === value && value !== Infinity && value !== -Infinity;\n  }\n\n  // Note: This is performance-critical code\n  function _setRaw(raw, key, value, columnSchema) {\n    var type = columnSchema.type,\n      isOptional = columnSchema.isOptional;\n\n    // If the value is wrong type or invalid, it's set to `null` (if optional) or empty value ('', 0, false)\n    if ('string' === type) {\n      if ('string' === typeof value) {\n        raw[key] = value;\n      } else {\n        raw[key] = isOptional ? null : '';\n      }\n    } else if ('boolean' === type) {\n      if ('boolean' === typeof value) {\n        raw[key] = value;\n      } else if (1 === value || 0 === value) {\n        // Exception to the standard rule — because SQLite turns true/false into 1/0\n        raw[key] = Boolean(value);\n      } else {\n        raw[key] = isOptional ? null : false;\n      }\n    } else {\n      // type = number\n      // Treat NaN and Infinity as null\n      if (isValidNumber(value)) {\n        raw[key] = value || 0;\n      } else {\n        raw[key] = isOptional ? null : 0;\n      }\n    }\n  }\n  function isValidStatus(value) {\n    return 'created' === value || 'updated' === value || 'deleted' === value || 'synced' === value;\n  }\n\n  // Transforms a dirty raw record object into a trusted sanitized RawRecord according to passed TableSchema\n  // TODO: Should we make this public API for advanced users?\n  function sanitizedRaw(dirtyRaw, tableSchema) {\n    var id = dirtyRaw.id,\n      _status = dirtyRaw._status,\n      _changed = dirtyRaw._changed;\n\n    // This is called with `{}` when making a new record, so we need to set a new ID, status\n    // Also: If an existing has one of those fields broken, we're screwed. Safest to treat it as a\n    // new record (so that it gets synced)\n\n    // TODO: Think about whether prototypeless objects are a useful mitigation\n    // const raw = Object.create(null) // create a prototypeless object\n    var raw = {};\n    if ('string' === typeof id) {\n      // TODO: Can we trust IDs passed? Maybe we want to split this implementation, depending on whether\n      // this is used on implicitly-trusted (persisted or Watermelon-created) records, or if this is user input?\n      raw.id = id;\n      raw._status = isValidStatus(_status) ? _status : 'created';\n      raw._changed = 'string' === typeof _changed ? _changed : '';\n    } else {\n      raw.id = (0, _randomId.default)();\n      raw._status = 'created';\n      raw._changed = '';\n    }\n\n    // faster than Object.values on a map\n    var columns = tableSchema.columnArray;\n    for (var i = 0, len = columns.length; i < len; i += 1) {\n      var columnSchema = columns[i];\n      var key = columnSchema.name;\n      // TODO: Check performance\n      // $FlowFixMe\n      var value = Object.prototype.hasOwnProperty.call(dirtyRaw, key) ? dirtyRaw[key] : null;\n      _setRaw(raw, key, value, columnSchema);\n    }\n    return raw;\n  }\n\n  // Modifies passed rawRecord by setting sanitized `value` to `columnName`\n  // Note: Assumes columnName exists and columnSchema matches the name\n  function setRawSanitized(rawRecord, columnName, value, columnSchema) {\n    _setRaw(rawRecord, columnName, value, columnSchema);\n  }\n  function nullValue(columnSchema) {\n    var isOptional = columnSchema.isOptional,\n      type = columnSchema.type;\n    if (isOptional) {\n      return null;\n    } else if ('string' === type) {\n      return '';\n    } else if ('number' === type) {\n      return 0;\n    } else if ('boolean' === type) {\n      return false;\n    }\n    throw new Error(\"Unknown type for column schema \".concat(JSON.stringify(columnSchema)));\n  }\n});","lineCount":119,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0],[4,6,3,4,"_interopRequireDefault"],[4,28,3,26],[4,31,3,29,"require"],[4,38,3,36],[4,39,3,36,"_dependencyMap"],[4,53,3,36],[4,104,3,83],[4,105,3,84],[5,2,4,0,"exports"],[5,9,4,7],[5,10,4,8,"__esModule"],[5,20,4,18],[5,23,4,21],[5,27,4,25],[6,2,5,0,"exports"],[6,9,5,7],[6,10,5,8,"nullValue"],[6,19,5,17],[6,22,5,20,"nullValue"],[6,31,5,29],[7,2,6,0,"exports"],[7,9,6,7],[7,10,6,8,"sanitizedRaw"],[7,22,6,20],[7,25,6,23,"sanitizedRaw"],[7,37,6,35],[8,2,7,0,"exports"],[8,9,7,7],[8,10,7,8,"setRawSanitized"],[8,25,7,23],[8,28,7,26,"setRawSanitized"],[8,43,7,41],[9,2,8,0],[9,6,8,4,"_randomId"],[9,15,8,13],[9,18,8,16,"_interopRequireDefault"],[9,40,8,38],[9,41,8,39,"require"],[9,48,8,46],[9,49,8,46,"_dependencyMap"],[9,63,8,46],[9,94,8,73],[9,95,8,74],[9,96,8,75],[10,2,9,0],[11,2,10,0],[12,2,11,0],[13,2,12,0],[14,2,13,0],[15,2,14,0],[16,2,15,0],[17,2,16,0],[18,2,17,0],[19,2,18,0],[20,2,19,0],[21,2,20,0],[22,2,21,0],[22,11,21,9,"isValidNumber"],[22,24,21,22,"isValidNumber"],[22,25,21,23,"value"],[22,30,21,28],[22,32,21,30],[23,4,22,2],[23,11,22,9],[23,19,22,17],[23,24,22,22],[23,31,22,29,"value"],[23,36,22,34],[23,40,22,38,"value"],[23,45,22,43],[23,50,22,48,"value"],[23,55,22,53],[23,59,22,57,"value"],[23,64,22,62],[23,69,22,67,"Infinity"],[23,77,22,75],[23,81,22,79,"value"],[23,86,22,84],[23,91,22,89],[23,92,22,90,"Infinity"],[23,100,22,98],[24,2,23,0],[26,2,25,0],[27,2,26,0],[27,11,26,9,"_setRaw"],[27,18,26,16,"_setRaw"],[27,19,26,17,"raw"],[27,22,26,20],[27,24,26,22,"key"],[27,27,26,25],[27,29,26,27,"value"],[27,34,26,32],[27,36,26,34,"columnSchema"],[27,48,26,46],[27,50,26,48],[28,4,27,2],[28,8,28,10,"type"],[28,12,28,14],[28,15,30,6,"columnSchema"],[28,27,30,18],[28,28,28,4,"type"],[28,32,28,8],[29,6,29,16,"isOptional"],[29,16,29,26],[29,19,30,6,"columnSchema"],[29,31,30,18],[29,32,29,4,"isOptional"],[29,42,29,14],[31,4,32,2],[32,4,33,2],[32,8,33,6],[32,16,33,14],[32,21,33,19,"type"],[32,25,33,23],[32,27,33,25],[33,6,34,4],[33,10,34,8],[33,18,34,16],[33,23,34,21],[33,30,34,28,"value"],[33,35,34,33],[33,37,34,35],[34,8,35,6,"raw"],[34,11,35,9],[34,12,35,10,"key"],[34,15,35,13],[34,16,35,14],[34,19,35,17,"value"],[34,24,35,22],[35,6,36,4],[35,7,36,5],[35,13,36,11],[36,8,37,6,"raw"],[36,11,37,9],[36,12,37,10,"key"],[36,15,37,13],[36,16,37,14],[36,19,37,17,"isOptional"],[36,29,37,27],[36,32,37,30],[36,36,37,34],[36,39,37,37],[36,41,37,39],[37,6,38,4],[38,4,39,2],[38,5,39,3],[38,11,39,9],[38,15,39,13],[38,24,39,22],[38,29,39,27,"type"],[38,33,39,31],[38,35,39,33],[39,6,40,4],[39,10,40,8],[39,19,40,17],[39,24,40,22],[39,31,40,29,"value"],[39,36,40,34],[39,38,40,36],[40,8,41,6,"raw"],[40,11,41,9],[40,12,41,10,"key"],[40,15,41,13],[40,16,41,14],[40,19,41,17,"value"],[40,24,41,22],[41,6,42,4],[41,7,42,5],[41,13,42,11],[41,17,42,15],[41,18,42,16],[41,23,42,21,"value"],[41,28,42,26],[41,32,42,30],[41,33,42,31],[41,38,42,36,"value"],[41,43,42,41],[41,45,42,43],[42,8,43,6],[43,8,44,6,"raw"],[43,11,44,9],[43,12,44,10,"key"],[43,15,44,13],[43,16,44,14],[43,19,44,17,"Boolean"],[43,26,44,24],[43,27,44,25,"value"],[43,32,44,30],[43,33,44,31],[44,6,45,4],[44,7,45,5],[44,13,45,11],[45,8,46,6,"raw"],[45,11,46,9],[45,12,46,10,"key"],[45,15,46,13],[45,16,46,14],[45,19,46,17,"isOptional"],[45,29,46,27],[45,32,46,30],[45,36,46,34],[45,39,46,37],[45,44,46,42],[46,6,47,4],[47,4,48,2],[47,5,48,3],[47,11,48,9],[48,6,49,4],[49,6,50,4],[50,6,51,4],[50,10,51,8,"isValidNumber"],[50,23,51,21],[50,24,51,22,"value"],[50,29,51,27],[50,30,51,28],[50,32,51,30],[51,8,52,6,"raw"],[51,11,52,9],[51,12,52,10,"key"],[51,15,52,13],[51,16,52,14],[51,19,52,17,"value"],[51,24,52,22],[51,28,52,26],[51,29,52,27],[52,6,53,4],[52,7,53,5],[52,13,53,11],[53,8,54,6,"raw"],[53,11,54,9],[53,12,54,10,"key"],[53,15,54,13],[53,16,54,14],[53,19,54,17,"isOptional"],[53,29,54,27],[53,32,54,30],[53,36,54,34],[53,39,54,37],[53,40,54,38],[54,6,55,4],[55,4,56,2],[56,2,57,0],[57,2,58,0],[57,11,58,9,"isValidStatus"],[57,24,58,22,"isValidStatus"],[57,25,58,23,"value"],[57,30,58,28],[57,32,58,30],[58,4,59,2],[58,11,59,9],[58,20,59,18],[58,25,59,23,"value"],[58,30,59,28],[58,34,59,32],[58,43,59,41],[58,48,59,46,"value"],[58,53,59,51],[58,57,59,55],[58,66,59,64],[58,71,59,69,"value"],[58,76,59,74],[58,80,59,78],[58,88,59,86],[58,93,59,91,"value"],[58,98,59,96],[59,2,60,0],[61,2,62,0],[62,2,63,0],[63,2,64,0],[63,11,64,9,"sanitizedRaw"],[63,23,64,21,"sanitizedRaw"],[63,24,64,22,"dirtyRaw"],[63,32,64,30],[63,34,64,32,"tableSchema"],[63,45,64,43],[63,47,64,45],[64,4,65,2],[64,8,66,8,"id"],[64,10,66,10],[64,13,69,6,"dirtyRaw"],[64,21,69,14],[64,22,66,4,"id"],[64,24,66,6],[65,6,67,13,"_status"],[65,13,67,20],[65,16,69,6,"dirtyRaw"],[65,24,69,14],[65,25,67,4,"_status"],[65,32,67,11],[66,6,68,14,"_changed"],[66,14,68,22],[66,17,69,6,"dirtyRaw"],[66,25,69,14],[66,26,68,4,"_changed"],[66,34,68,12],[68,4,71,2],[69,4,72,2],[70,4,73,2],[72,4,75,2],[73,4,76,2],[74,4,77,2],[74,8,77,6,"raw"],[74,11,77,9],[74,14,77,12],[74,15,77,13],[74,16,77,14],[75,4,78,2],[75,8,78,6],[75,16,78,14],[75,21,78,19],[75,28,78,26,"id"],[75,30,78,28],[75,32,78,30],[76,6,79,4],[77,6,80,4],[78,6,81,4,"raw"],[78,9,81,7],[78,10,81,8,"id"],[78,12,81,10],[78,15,81,13,"id"],[78,17,81,15],[79,6,82,4,"raw"],[79,9,82,7],[79,10,82,8,"_status"],[79,17,82,15],[79,20,82,18,"isValidStatus"],[79,33,82,31],[79,34,82,32,"_status"],[79,41,82,39],[79,42,82,40],[79,45,82,43,"_status"],[79,52,82,50],[79,55,82,53],[79,64,82,62],[80,6,83,4,"raw"],[80,9,83,7],[80,10,83,8,"_changed"],[80,18,83,16],[80,21,83,19],[80,29,83,27],[80,34,83,32],[80,41,83,39,"_changed"],[80,49,83,47],[80,52,83,50,"_changed"],[80,60,83,58],[80,63,83,61],[80,65,83,63],[81,4,84,2],[81,5,84,3],[81,11,84,9],[82,6,85,4,"raw"],[82,9,85,7],[82,10,85,8,"id"],[82,12,85,10],[82,15,85,13],[82,16,85,14],[82,17,85,15],[82,19,85,17,"_randomId"],[82,28,85,26],[82,29,85,27,"default"],[82,36,85,34],[82,38,85,36],[82,39,85,37],[83,6,86,4,"raw"],[83,9,86,7],[83,10,86,8,"_status"],[83,17,86,15],[83,20,86,18],[83,29,86,27],[84,6,87,4,"raw"],[84,9,87,7],[84,10,87,8,"_changed"],[84,18,87,16],[84,21,87,19],[84,23,87,21],[85,4,88,2],[87,4,90,2],[88,4,91,2],[88,8,91,6,"columns"],[88,15,91,13],[88,18,91,16,"tableSchema"],[88,29,91,27],[88,30,91,28,"columnArray"],[88,41,91,39],[89,4,92,2],[89,9,92,7],[89,13,92,11,"i"],[89,14,92,12],[89,17,92,15],[89,18,92,16],[89,20,92,18,"len"],[89,23,92,21],[89,26,92,24,"columns"],[89,33,92,31],[89,34,92,32,"length"],[89,40,92,38],[89,42,92,40,"i"],[89,43,92,41],[89,46,92,44,"len"],[89,49,92,47],[89,51,92,49,"i"],[89,52,92,50],[89,56,92,54],[89,57,92,55],[89,59,92,57],[90,6,93,4],[90,10,93,8,"columnSchema"],[90,22,93,20],[90,25,93,23,"columns"],[90,32,93,30],[90,33,93,31,"i"],[90,34,93,32],[90,35,93,33],[91,6,94,4],[91,10,94,8,"key"],[91,13,94,11],[91,16,94,14,"columnSchema"],[91,28,94,26],[91,29,94,27,"name"],[91,33,94,31],[92,6,95,4],[93,6,96,4],[94,6,97,4],[94,10,97,8,"value"],[94,15,97,13],[94,18,97,16,"Object"],[94,24,97,22],[94,25,97,23,"prototype"],[94,34,97,32],[94,35,97,33,"hasOwnProperty"],[94,49,97,47],[94,50,97,48,"call"],[94,54,97,52],[94,55,97,53,"dirtyRaw"],[94,63,97,61],[94,65,97,63,"key"],[94,68,97,66],[94,69,97,67],[94,72,97,70,"dirtyRaw"],[94,80,97,78],[94,81,97,79,"key"],[94,84,97,82],[94,85,97,83],[94,88,97,86],[94,92,97,90],[95,6,98,4,"_setRaw"],[95,13,98,11],[95,14,98,12,"raw"],[95,17,98,15],[95,19,98,17,"key"],[95,22,98,20],[95,24,98,22,"value"],[95,29,98,27],[95,31,98,29,"columnSchema"],[95,43,98,41],[95,44,98,42],[96,4,99,2],[97,4,100,2],[97,11,100,9,"raw"],[97,14,100,12],[98,2,101,0],[100,2,103,0],[101,2,104,0],[102,2,105,0],[102,11,105,9,"setRawSanitized"],[102,26,105,24,"setRawSanitized"],[102,27,105,25,"rawRecord"],[102,36,105,34],[102,38,105,36,"columnName"],[102,48,105,46],[102,50,105,48,"value"],[102,55,105,53],[102,57,105,55,"columnSchema"],[102,69,105,67],[102,71,105,69],[103,4,106,2,"_setRaw"],[103,11,106,9],[103,12,106,10,"rawRecord"],[103,21,106,19],[103,23,106,21,"columnName"],[103,33,106,31],[103,35,106,33,"value"],[103,40,106,38],[103,42,106,40,"columnSchema"],[103,54,106,52],[103,55,106,53],[104,2,107,0],[105,2,108,0],[105,11,108,9,"nullValue"],[105,20,108,18,"nullValue"],[105,21,108,19,"columnSchema"],[105,33,108,31],[105,35,108,33],[106,4,109,2],[106,8,110,16,"isOptional"],[106,18,110,26],[106,21,112,6,"columnSchema"],[106,33,112,18],[106,34,110,4,"isOptional"],[106,44,110,14],[107,6,111,10,"type"],[107,10,111,14],[107,13,112,6,"columnSchema"],[107,25,112,18],[107,26,111,4,"type"],[107,30,111,8],[108,4,113,2],[108,8,113,6,"isOptional"],[108,18,113,16],[108,20,113,18],[109,6,114,4],[109,13,114,11],[109,17,114,15],[110,4,115,2],[110,5,115,3],[110,11,115,9],[110,15,115,13],[110,23,115,21],[110,28,115,26,"type"],[110,32,115,30],[110,34,115,32],[111,6,116,4],[111,13,116,11],[111,15,116,13],[112,4,117,2],[112,5,117,3],[112,11,117,9],[112,15,117,13],[112,23,117,21],[112,28,117,26,"type"],[112,32,117,30],[112,34,117,32],[113,6,118,4],[113,13,118,11],[113,14,118,12],[114,4,119,2],[114,5,119,3],[114,11,119,9],[114,15,119,13],[114,24,119,22],[114,29,119,27,"type"],[114,33,119,31],[114,35,119,33],[115,6,120,4],[115,13,120,11],[115,18,120,16],[116,4,121,2],[117,4,122,2],[117,10,122,8],[117,14,122,12,"Error"],[117,19,122,17],[117,20,122,18],[117,53,122,51],[117,54,122,52,"concat"],[117,60,122,58],[117,61,122,59,"JSON"],[117,65,122,63],[117,66,122,64,"stringify"],[117,75,122,73],[117,76,122,74,"columnSchema"],[117,88,122,86],[117,89,122,87],[117,90,122,88],[117,91,122,89],[118,2,123,0],[119,0,123,1],[119,3]],"functionMap":{"names":["<global>","isValidNumber","_setRaw","isValidStatus","sanitizedRaw","setRawSanitized","nullValue"],"mappings":"AAA;ACoB;CDE;AEG;CF+B;AGC;CHE;AII;CJqC;AKI;CLE;AMC"},"hasCjsExports":true},"type":"js/module"}]}