{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":29,"index":44},"end":{"line":3,"column":84,"index":99}}],"key":"kslwqCIsh6ew+I1KeA1rlVRjsAk=","exportNames":["*"],"imports":1}},{"name":"../../utils/common","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":6,"column":14,"index":187},"end":{"line":6,"column":43,"index":216}}],"key":"f8rxJKsVH8u9Uvy41cjr6BETN6o=","exportNames":["*"],"imports":1}},{"name":"../../utils/fp/identicalArrays","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":7,"column":46,"index":264},"end":{"line":7,"column":87,"index":305}}],"key":"kkcIWN0yjzDpDf8rp16crxlPC6A=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  exports.__esModule = true;\n  exports.default = subscribeToQueryReloading;\n  var _common = require(_dependencyMap[1], \"../../utils/common\");\n  var _identicalArrays = _interopRequireDefault(require(_dependencyMap[2], \"../../utils/fp/identicalArrays\"));\n  // Produces an observable version of a query by re-querying the database\n  // when any change occurs in any of the relevant Stores.\n  // This is inefficient for simple queries, but necessary for complex queries\n  function subscribeToQueryReloading(query, subscriber,\n  // Emits `false` when query fetch begins + always emits even if no change - internal trick needed\n  // by observeWithColumns\n  shouldEmitStatus = false) {\n    var {\n      collection: collection\n    } = query;\n    var previousRecords = null;\n    var unsubscribed = false;\n    function reloadingObserverFetch() {\n      if (shouldEmitStatus) {\n        unsubscribed || subscriber(false);\n      }\n      collection._fetchQuery(query, function (result) {\n        if (result.error) {\n          (0, _common.logError)(result.error.toString());\n          return;\n        }\n        var records = result.value;\n        var shouldEmit = !unsubscribed && (shouldEmitStatus || !previousRecords || !(0, _identicalArrays.default)(records, previousRecords));\n        previousRecords = records;\n        shouldEmit && subscriber(records);\n      });\n    }\n    var unsubscribe = collection.database.experimentalSubscribe(query.allTables, reloadingObserverFetch, {\n      name: 'subscribeToQueryReloading observation',\n      query: query,\n      subscriber: subscriber\n    });\n    reloadingObserverFetch();\n    return function () {\n      unsubscribed = true;\n      unsubscribe();\n    };\n  }\n});","lineCount":47,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0],[4,6,3,4,"_interopRequireDefault"],[4,28,3,26],[4,31,3,29,"require"],[4,38,3,36],[4,39,3,36,"_dependencyMap"],[4,53,3,36],[4,104,3,83],[4,105,3,84],[5,2,4,0,"exports"],[5,9,4,7],[5,10,4,8,"__esModule"],[5,20,4,18],[5,23,4,21],[5,27,4,25],[6,2,5,0,"exports"],[6,9,5,7],[6,10,5,8,"default"],[6,17,5,15],[6,20,5,18,"subscribeToQueryReloading"],[6,45,5,43],[7,2,6,0],[7,6,6,4,"_common"],[7,13,6,11],[7,16,6,14,"require"],[7,23,6,21],[7,24,6,21,"_dependencyMap"],[7,38,6,21],[7,63,6,42],[7,64,6,43],[8,2,7,0],[8,6,7,4,"_identicalArrays"],[8,22,7,20],[8,25,7,23,"_interopRequireDefault"],[8,47,7,45],[8,48,7,46,"require"],[8,55,7,53],[8,56,7,53,"_dependencyMap"],[8,70,7,53],[8,107,7,86],[8,108,7,87],[8,109,7,88],[9,2,8,0],[10,2,9,0],[11,2,10,0],[12,2,11,0],[12,11,11,9,"subscribeToQueryReloading"],[12,36,11,34,"subscribeToQueryReloading"],[12,37,11,35,"query"],[12,42,11,40],[12,44,11,42,"subscriber"],[12,54,11,52],[13,2,12,0],[14,2,13,0],[15,2,14,0,"shouldEmitStatus"],[15,18,14,16],[15,21,14,19],[15,26,14,24],[15,28,14,26],[16,4,15,2],[16,8,15,6],[17,6,16,4,"collection"],[17,16,16,14],[17,18,16,16,"collection"],[18,4,17,2],[18,5,17,3],[18,8,17,6,"query"],[18,13,17,11],[19,4,18,2],[19,8,18,6,"previousRecords"],[19,23,18,21],[19,26,18,24],[19,30,18,28],[20,4,19,2],[20,8,19,6,"unsubscribed"],[20,20,19,18],[20,23,19,21],[20,28,19,26],[21,4,20,2],[21,13,20,11,"reloadingObserverFetch"],[21,35,20,33,"reloadingObserverFetch"],[21,36,20,33],[21,38,20,36],[22,6,21,4],[22,10,21,8,"shouldEmitStatus"],[22,26,21,24],[22,28,21,26],[23,8,22,6,"unsubscribed"],[23,20,22,18],[23,24,22,22,"subscriber"],[23,34,22,32],[23,35,22,33],[23,40,22,38],[23,41,22,39],[24,6,23,4],[25,6,24,4,"collection"],[25,16,24,14],[25,17,24,15,"_fetchQuery"],[25,28,24,26],[25,29,24,27,"query"],[25,34,24,32],[25,36,24,34],[25,46,24,44,"result"],[25,52,24,50],[25,54,24,52],[26,8,25,6],[26,12,25,10,"result"],[26,18,25,16],[26,19,25,17,"error"],[26,24,25,22],[26,26,25,24],[27,10,26,8],[27,11,26,9],[27,12,26,10],[27,14,26,12,"_common"],[27,21,26,19],[27,22,26,20,"logError"],[27,30,26,28],[27,32,26,30,"result"],[27,38,26,36],[27,39,26,37,"error"],[27,44,26,42],[27,45,26,43,"toString"],[27,53,26,51],[27,54,26,52],[27,55,26,53],[27,56,26,54],[28,10,27,8],[29,8,28,6],[30,8,29,6],[30,12,29,10,"records"],[30,19,29,17],[30,22,29,20,"result"],[30,28,29,26],[30,29,29,27,"value"],[30,34,29,32],[31,8,30,6],[31,12,30,10,"shouldEmit"],[31,22,30,20],[31,25,30,23],[31,26,30,24,"unsubscribed"],[31,38,30,36],[31,43,30,41,"shouldEmitStatus"],[31,59,30,57],[31,63,30,61],[31,64,30,62,"previousRecords"],[31,79,30,77],[31,83,30,81],[31,84,30,82],[31,85,30,83],[31,86,30,84],[31,88,30,86,"_identicalArrays"],[31,104,30,102],[31,105,30,103,"default"],[31,112,30,110],[31,114,30,112,"records"],[31,121,30,119],[31,123,30,121,"previousRecords"],[31,138,30,136],[31,139,30,137],[31,140,30,138],[32,8,31,6,"previousRecords"],[32,23,31,21],[32,26,31,24,"records"],[32,33,31,31],[33,8,32,6,"shouldEmit"],[33,18,32,16],[33,22,32,20,"subscriber"],[33,32,32,30],[33,33,32,31,"records"],[33,40,32,38],[33,41,32,39],[34,6,33,4],[34,7,33,5],[34,8,33,6],[35,4,34,2],[36,4,35,2],[36,8,35,6,"unsubscribe"],[36,19,35,17],[36,22,35,20,"collection"],[36,32,35,30],[36,33,35,31,"database"],[36,41,35,39],[36,42,35,40,"experimentalSubscribe"],[36,63,35,61],[36,64,35,62,"query"],[36,69,35,67],[36,70,35,68,"allTables"],[36,79,35,77],[36,81,35,79,"reloadingObserverFetch"],[36,103,35,101],[36,105,35,103],[37,6,36,4,"name"],[37,10,36,8],[37,12,36,10],[37,51,36,49],[38,6,37,4,"query"],[38,11,37,9],[38,13,37,11,"query"],[38,18,37,16],[39,6,38,4,"subscriber"],[39,16,38,14],[39,18,38,16,"subscriber"],[40,4,39,2],[40,5,39,3],[40,6,39,4],[41,4,40,2,"reloadingObserverFetch"],[41,26,40,24],[41,27,40,25],[41,28,40,26],[42,4,41,2],[42,11,41,9],[42,23,41,21],[43,6,42,4,"unsubscribed"],[43,18,42,16],[43,21,42,19],[43,25,42,23],[44,6,43,4,"unsubscribe"],[44,17,43,15],[44,18,43,16],[44,19,43,17],[45,4,44,2],[45,5,44,3],[46,2,45,0],[47,0,45,1],[47,3]],"functionMap":{"names":["<global>","subscribeToQueryReloading","reloadingObserverFetch","collection._fetchQuery$argument_1","<anonymous>"],"mappings":"AAA;ACU;ECS;kCCI;KDS;GDC;SGO;GHG"},"hasCjsExports":true},"type":"js/module"}]}