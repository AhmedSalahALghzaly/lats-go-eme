{"dependencies":[{"name":"../common","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":5,"column":14,"index":106},"end":{"line":5,"column":34,"index":126}}],"key":"vhvRLAgg70cx5BlWoiEZedxJwuQ=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  exports.__esModule = true;\n  exports.jsonDecorator = exports.default = void 0;\n  var _common = require(_dependencyMap[0], \"../common\");\n  // Defines a model property that's (de)serialized to and from JSON using custom sanitizer function.\n  //\n  // Pass the database column name as first argument, and sanitizer function as second.\n  //\n  // Stored value will be parsed to JSON if possible, and passed to sanitizer as argument, or\n  // undefined will be passed on parsing error. Field value will be result of sanitizer call.\n  //\n  // Value assigned to field will be passed to sanitizer and its results will be stored as stringified\n  // value.\n  //\n  // Examples:\n  //   @json('contact_info', jsonValue => jasonValue || {}) contactInfo: ContactInfo\n  var parseJSON = function (value) {\n    // fast path\n    if (null === value || value === undefined || '' === value) {\n      return undefined;\n    }\n    try {\n      return JSON.parse(value);\n    } catch (_) {\n      return undefined;\n    }\n  };\n  var defaultOptions = {\n    memo: false\n  };\n  var jsonDecorator = exports.jsonDecorator = function (rawFieldName, sanitizer) {\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : defaultOptions;\n    return function (target, key, descriptor) {\n      (0, _common.ensureDecoratorUsedProperly)(rawFieldName, target, key, descriptor);\n      return {\n        configurable: true,\n        enumerable: true,\n        get: function get() {\n          // $FlowFixMe\n          var model = this;\n          var rawValue = model.asModel._getRaw(rawFieldName);\n          if (options.memo) {\n            // Use cached value if possible\n            model._jsonDecoratorCache = model._jsonDecoratorCache || {};\n            var cachedEntry = model._jsonDecoratorCache[rawFieldName];\n            if (cachedEntry && cachedEntry[0] === rawValue) {\n              return cachedEntry[1];\n            }\n          }\n          var parsedValue = parseJSON(rawValue);\n          var sanitized = sanitizer(parsedValue, model);\n          if (options.memo) {\n            model._jsonDecoratorCache[rawFieldName] = [rawValue, sanitized];\n          }\n          return sanitized;\n        },\n        set: function set(json) {\n          // $FlowFixMe\n          var model = this;\n          var sanitizedValue = sanitizer(json, model);\n          var stringifiedValue = null != sanitizedValue ? JSON.stringify(sanitizedValue) : null;\n          model.asModel._setRaw(rawFieldName, stringifiedValue);\n        }\n      };\n    };\n  };\n  var _default = exports.default = jsonDecorator;\n});","lineCount":70,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0,"exports"],[4,9,3,7],[4,10,3,8,"__esModule"],[4,20,3,18],[4,23,3,21],[4,27,3,25],[5,2,4,0,"exports"],[5,9,4,7],[5,10,4,8,"jsonDecorator"],[5,23,4,21],[5,26,4,24,"exports"],[5,33,4,31],[5,34,4,32,"default"],[5,41,4,39],[5,44,4,42],[5,49,4,47],[5,50,4,48],[6,2,5,0],[6,6,5,4,"_common"],[6,13,5,11],[6,16,5,14,"require"],[6,23,5,21],[6,24,5,21,"_dependencyMap"],[6,38,5,21],[6,54,5,33],[6,55,5,34],[7,2,6,0],[8,2,7,0],[9,2,8,0],[10,2,9,0],[11,2,10,0],[12,2,11,0],[13,2,12,0],[14,2,13,0],[15,2,14,0],[16,2,15,0],[17,2,16,0],[18,2,17,0],[19,2,18,0],[19,6,18,4,"parseJSON"],[19,15,18,13],[19,18,18,16],[19,27,18,16,"parseJSON"],[19,28,18,26,"value"],[19,33,18,31],[19,35,18,33],[20,4,19,2],[21,4,20,2],[21,8,20,6],[21,12,20,10],[21,17,20,15,"value"],[21,22,20,20],[21,26,20,24,"value"],[21,31,20,29],[21,36,20,34,"undefined"],[21,45,20,43],[21,49,20,47],[21,51,20,49],[21,56,20,54,"value"],[21,61,20,59],[21,63,20,61],[22,6,21,4],[22,13,21,11,"undefined"],[22,22,21,20],[23,4,22,2],[24,4,23,2],[24,8,23,6],[25,6,24,4],[25,13,24,11,"JSON"],[25,17,24,15],[25,18,24,16,"parse"],[25,23,24,21],[25,24,24,22,"value"],[25,29,24,27],[25,30,24,28],[26,4,25,2],[26,5,25,3],[26,6,25,4],[26,13,25,11,"_"],[26,14,25,12],[26,16,25,14],[27,6,26,4],[27,13,26,11,"undefined"],[27,22,26,20],[28,4,27,2],[29,2,28,0],[29,3,28,1],[30,2,29,0],[30,6,29,4,"defaultOptions"],[30,20,29,18],[30,23,29,21],[31,4,30,2,"memo"],[31,8,30,6],[31,10,30,8],[32,2,31,0],[32,3,31,1],[33,2,32,0],[33,6,32,4,"jsonDecorator"],[33,19,32,17],[33,22,32,20,"exports"],[33,29,32,27],[33,30,32,28,"jsonDecorator"],[33,43,32,41],[33,46,32,44],[33,56,32,54,"rawFieldName"],[33,68,32,66],[33,70,32,68,"sanitizer"],[33,79,32,77],[33,81,32,105],[34,4,32,105],[34,8,32,79,"options"],[34,15,32,86],[34,18,32,86,"arguments"],[34,27,32,86],[34,28,32,86,"length"],[34,34,32,86],[34,42,32,86,"arguments"],[34,51,32,86],[34,59,32,86,"undefined"],[34,68,32,86],[34,71,32,86,"arguments"],[34,80,32,86],[34,86,32,89,"defaultOptions"],[34,100,32,103],[35,4,33,2],[35,11,33,9],[35,21,33,19,"target"],[35,27,33,25],[35,29,33,27,"key"],[35,32,33,30],[35,34,33,32,"descriptor"],[35,44,33,42],[35,46,33,44],[36,6,34,4],[36,7,34,5],[36,8,34,6],[36,10,34,8,"_common"],[36,17,34,15],[36,18,34,16,"ensureDecoratorUsedProperly"],[36,45,34,43],[36,47,34,45,"rawFieldName"],[36,59,34,57],[36,61,34,59,"target"],[36,67,34,65],[36,69,34,67,"key"],[36,72,34,70],[36,74,34,72,"descriptor"],[36,84,34,82],[36,85,34,83],[37,6,35,4],[37,13,35,11],[38,8,36,6,"configurable"],[38,20,36,18],[38,22,36,20],[38,26,36,24],[39,8,37,6,"enumerable"],[39,18,37,16],[39,20,37,18],[39,24,37,22],[40,8,38,6,"get"],[40,11,38,9],[40,13,38,11],[40,22,38,20,"get"],[40,25,38,23,"get"],[40,26,38,23],[40,28,38,26],[41,10,39,8],[42,10,40,8],[42,14,40,12,"model"],[42,19,40,17],[42,22,40,20],[42,26,40,24],[43,10,41,8],[43,14,41,12,"rawValue"],[43,22,41,20],[43,25,41,23,"model"],[43,30,41,28],[43,31,41,29,"asModel"],[43,38,41,36],[43,39,41,37,"_getRaw"],[43,46,41,44],[43,47,41,45,"rawFieldName"],[43,59,41,57],[43,60,41,58],[44,10,42,8],[44,14,42,12,"options"],[44,21,42,19],[44,22,42,20,"memo"],[44,26,42,24],[44,28,42,26],[45,12,43,10],[46,12,44,10,"model"],[46,17,44,15],[46,18,44,16,"_jsonDecoratorCache"],[46,37,44,35],[46,40,44,38,"model"],[46,45,44,43],[46,46,44,44,"_jsonDecoratorCache"],[46,65,44,63],[46,69,44,67],[46,70,44,68],[46,71,44,69],[47,12,45,10],[47,16,45,14,"cachedEntry"],[47,27,45,25],[47,30,45,28,"model"],[47,35,45,33],[47,36,45,34,"_jsonDecoratorCache"],[47,55,45,53],[47,56,45,54,"rawFieldName"],[47,68,45,66],[47,69,45,67],[48,12,46,10],[48,16,46,14,"cachedEntry"],[48,27,46,25],[48,31,46,29,"cachedEntry"],[48,42,46,40],[48,43,46,41],[48,44,46,42],[48,45,46,43],[48,50,46,48,"rawValue"],[48,58,46,56],[48,60,46,58],[49,14,47,12],[49,21,47,19,"cachedEntry"],[49,32,47,30],[49,33,47,31],[49,34,47,32],[49,35,47,33],[50,12,48,10],[51,10,49,8],[52,10,50,8],[52,14,50,12,"parsedValue"],[52,25,50,23],[52,28,50,26,"parseJSON"],[52,37,50,35],[52,38,50,36,"rawValue"],[52,46,50,44],[52,47,50,45],[53,10,51,8],[53,14,51,12,"sanitized"],[53,23,51,21],[53,26,51,24,"sanitizer"],[53,35,51,33],[53,36,51,34,"parsedValue"],[53,47,51,45],[53,49,51,47,"model"],[53,54,51,52],[53,55,51,53],[54,10,52,8],[54,14,52,12,"options"],[54,21,52,19],[54,22,52,20,"memo"],[54,26,52,24],[54,28,52,26],[55,12,53,10,"model"],[55,17,53,15],[55,18,53,16,"_jsonDecoratorCache"],[55,37,53,35],[55,38,53,36,"rawFieldName"],[55,50,53,48],[55,51,53,49],[55,54,53,52],[55,55,53,53,"rawValue"],[55,63,53,61],[55,65,53,63,"sanitized"],[55,74,53,72],[55,75,53,73],[56,10,54,8],[57,10,55,8],[57,17,55,15,"sanitized"],[57,26,55,24],[58,8,56,6],[58,9,56,7],[59,8,57,6,"set"],[59,11,57,9],[59,13,57,11],[59,22,57,20,"set"],[59,25,57,23,"set"],[59,26,57,24,"json"],[59,30,57,28],[59,32,57,30],[60,10,58,8],[61,10,59,8],[61,14,59,12,"model"],[61,19,59,17],[61,22,59,20],[61,26,59,24],[62,10,60,8],[62,14,60,12,"sanitizedValue"],[62,28,60,26],[62,31,60,29,"sanitizer"],[62,40,60,38],[62,41,60,39,"json"],[62,45,60,43],[62,47,60,45,"model"],[62,52,60,50],[62,53,60,51],[63,10,61,8],[63,14,61,12,"stringifiedValue"],[63,30,61,28],[63,33,61,31],[63,37,61,35],[63,41,61,39,"sanitizedValue"],[63,55,61,53],[63,58,61,56,"JSON"],[63,62,61,60],[63,63,61,61,"stringify"],[63,72,61,70],[63,73,61,71,"sanitizedValue"],[63,87,61,85],[63,88,61,86],[63,91,61,89],[63,95,61,93],[64,10,62,8,"model"],[64,15,62,13],[64,16,62,14,"asModel"],[64,23,62,21],[64,24,62,22,"_setRaw"],[64,31,62,29],[64,32,62,30,"rawFieldName"],[64,44,62,42],[64,46,62,44,"stringifiedValue"],[64,62,62,60],[64,63,62,61],[65,8,63,6],[66,6,64,4],[66,7,64,5],[67,4,65,2],[67,5,65,3],[68,2,66,0],[68,3,66,1],[69,2,67,0],[69,6,67,4,"_default"],[69,14,67,12],[69,17,67,15,"exports"],[69,24,67,22],[69,25,67,23,"default"],[69,32,67,30],[69,35,67,33,"jsonDecorator"],[69,48,67,46],[70,0,67,47],[70,3]],"functionMap":{"names":["<global>","parseJSON","exports.jsonDecorator","<anonymous>","get","set"],"mappings":"AAA;gBCiB;CDU;4CEI;SCC;WCK;ODkB;WEC;OFM;GDE;CFC"},"hasCjsExports":true},"type":"js/module"}]}