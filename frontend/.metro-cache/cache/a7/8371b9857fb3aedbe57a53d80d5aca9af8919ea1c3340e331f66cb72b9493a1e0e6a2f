{"dependencies":[{"name":"../../utils/common","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":5,"column":14,"index":98},"end":{"line":5,"column":43,"index":127}}],"key":"f8rxJKsVH8u9Uvy41cjr6BETN6o=","exportNames":["*"],"imports":1}},{"name":"../encodeMatcher","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":42,"column":18,"index":1247},"end":{"line":42,"column":45,"index":1274}}],"key":"sRJLrlAaT6CROU8aUdxrV/n6mfQ=","exportNames":["*"],"imports":1}},{"name":"./processChangeSet","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":45,"column":23,"index":1354},"end":{"line":45,"column":52,"index":1383}}],"key":"1SRRAMijUng4ECburQAqbTqzsDQ=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  exports.__esModule = true;\n  exports.default = subscribeToSimpleQuery;\n  var _common = require(_dependencyMap[0], \"../../utils/common\");\n  function subscribeToSimpleQuery(query, subscriber) {\n    var alwaysEmit = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    var matcher = null;\n    var unsubscribed = false;\n    var unsubscribe = null;\n\n    // eslint-disable-next-line prefer-arrow-callback\n    query.collection._fetchQuery(query, function (result) {\n      if (unsubscribed) {\n        return;\n      }\n      if (result.error) {\n        (0, _common.logError)(result.error.toString());\n        return;\n      }\n      var initialRecords = result.value;\n\n      // Send initial matching records\n      var matchingRecords = initialRecords;\n      var emitCopy = function () {\n        return !unsubscribed && subscriber(matchingRecords.slice(0));\n      };\n      emitCopy();\n\n      // Check if emitCopy haven't completed source observable to avoid memory leaks\n      if (unsubscribed) {\n        return;\n      }\n\n      // Observe changes to the collection\n\n      // eslint-disable-next-line prefer-arrow-callback\n      unsubscribe = query.collection.experimentalSubscribe(function (changeSet) {\n        if (!matcher) {\n          matcher = require(_dependencyMap[1], \"../encodeMatcher\").default(query.description);\n        }\n        // $FlowFixMe\n        var shouldEmit = require(_dependencyMap[2], \"./processChangeSet\").default(changeSet, matcher, matchingRecords);\n        if (shouldEmit || alwaysEmit) {\n          emitCopy();\n        }\n      }, {\n        name: 'subscribeToSimpleQuery',\n        query: query,\n        subscriber: subscriber\n      });\n    });\n    return function () {\n      unsubscribed = true;\n      unsubscribe && unsubscribe();\n    };\n  }\n});","lineCount":59,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0,"exports"],[4,9,3,7],[4,10,3,8,"__esModule"],[4,20,3,18],[4,23,3,21],[4,27,3,25],[5,2,4,0,"exports"],[5,9,4,7],[5,10,4,8,"default"],[5,17,4,15],[5,20,4,18,"subscribeToSimpleQuery"],[5,42,4,40],[6,2,5,0],[6,6,5,4,"_common"],[6,13,5,11],[6,16,5,14,"require"],[6,23,5,21],[6,24,5,21,"_dependencyMap"],[6,38,5,21],[6,63,5,42],[6,64,5,43],[7,2,6,0],[7,11,6,9,"subscribeToSimpleQuery"],[7,33,6,31,"subscribeToSimpleQuery"],[7,34,6,32,"query"],[7,39,6,37],[7,41,6,39,"subscriber"],[7,51,6,49],[7,53,9,20],[8,4,9,20],[8,8,9,0,"alwaysEmit"],[8,18,9,10],[8,21,9,10,"arguments"],[8,30,9,10],[8,31,9,10,"length"],[8,37,9,10],[8,45,9,10,"arguments"],[8,54,9,10],[8,62,9,10,"undefined"],[8,71,9,10],[8,74,9,10,"arguments"],[8,83,9,10],[8,89,9,13],[8,94,9,18],[9,4,10,2],[9,8,10,6,"matcher"],[9,15,10,13],[9,18,10,16],[9,22,10,20],[10,4,11,2],[10,8,11,6,"unsubscribed"],[10,20,11,18],[10,23,11,21],[10,28,11,26],[11,4,12,2],[11,8,12,6,"unsubscribe"],[11,19,12,17],[11,22,12,20],[11,26,12,24],[13,4,14,2],[14,4,15,2,"query"],[14,9,15,7],[14,10,15,8,"collection"],[14,20,15,18],[14,21,15,19,"_fetchQuery"],[14,32,15,30],[14,33,15,31,"query"],[14,38,15,36],[14,40,15,38],[14,50,15,48,"result"],[14,56,15,54],[14,58,15,56],[15,6,16,4],[15,10,16,8,"unsubscribed"],[15,22,16,20],[15,24,16,22],[16,8,17,6],[17,6,18,4],[18,6,19,4],[18,10,19,8,"result"],[18,16,19,14],[18,17,19,15,"error"],[18,22,19,20],[18,24,19,22],[19,8,20,6],[19,9,20,7],[19,10,20,8],[19,12,20,10,"_common"],[19,19,20,17],[19,20,20,18,"logError"],[19,28,20,26],[19,30,20,28,"result"],[19,36,20,34],[19,37,20,35,"error"],[19,42,20,40],[19,43,20,41,"toString"],[19,51,20,49],[19,52,20,50],[19,53,20,51],[19,54,20,52],[20,8,21,6],[21,6,22,4],[22,6,23,4],[22,10,23,8,"initialRecords"],[22,24,23,22],[22,27,23,25,"result"],[22,33,23,31],[22,34,23,32,"value"],[22,39,23,37],[24,6,25,4],[25,6,26,4],[25,10,26,8,"matchingRecords"],[25,25,26,23],[25,28,26,26,"initialRecords"],[25,42,26,40],[26,6,27,4],[26,10,27,8,"emitCopy"],[26,18,27,16],[26,21,27,19],[26,30,27,19,"emitCopy"],[26,31,27,19],[26,33,27,31],[27,8,28,6],[27,15,28,13],[27,16,28,14,"unsubscribed"],[27,28,28,26],[27,32,28,30,"subscriber"],[27,42,28,40],[27,43,28,41,"matchingRecords"],[27,58,28,56],[27,59,28,57,"slice"],[27,64,28,62],[27,65,28,63],[27,66,28,64],[27,67,28,65],[27,68,28,66],[28,6,29,4],[28,7,29,5],[29,6,30,4,"emitCopy"],[29,14,30,12],[29,15,30,13],[29,16,30,14],[31,6,32,4],[32,6,33,4],[32,10,33,8,"unsubscribed"],[32,22,33,20],[32,24,33,22],[33,8,34,6],[34,6,35,4],[36,6,37,4],[38,6,39,4],[39,6,40,4,"unsubscribe"],[39,17,40,15],[39,20,40,18,"query"],[39,25,40,23],[39,26,40,24,"collection"],[39,36,40,34],[39,37,40,35,"experimentalSubscribe"],[39,58,40,56],[39,59,40,57],[39,69,40,67,"changeSet"],[39,78,40,76],[39,80,40,78],[40,8,41,6],[40,12,41,10],[40,13,41,11,"matcher"],[40,20,41,18],[40,22,41,20],[41,10,42,8,"matcher"],[41,17,42,15],[41,20,42,18,"require"],[41,27,42,25],[41,28,42,25,"_dependencyMap"],[41,42,42,25],[41,65,42,44],[41,66,42,45],[41,67,42,46,"default"],[41,74,42,53],[41,75,42,54,"query"],[41,80,42,59],[41,81,42,60,"description"],[41,92,42,71],[41,93,42,72],[42,8,43,6],[43,8,44,6],[44,8,45,6],[44,12,45,10,"shouldEmit"],[44,22,45,20],[44,25,45,23,"require"],[44,32,45,30],[44,33,45,30,"_dependencyMap"],[44,47,45,30],[44,72,45,51],[44,73,45,52],[44,74,45,53,"default"],[44,81,45,60],[44,82,45,61,"changeSet"],[44,91,45,70],[44,93,45,72,"matcher"],[44,100,45,79],[44,102,45,81,"matchingRecords"],[44,117,45,96],[44,118,45,97],[45,8,46,6],[45,12,46,10,"shouldEmit"],[45,22,46,20],[45,26,46,24,"alwaysEmit"],[45,36,46,34],[45,38,46,36],[46,10,47,8,"emitCopy"],[46,18,47,16],[46,19,47,17],[46,20,47,18],[47,8,48,6],[48,6,49,4],[48,7,49,5],[48,9,49,7],[49,8,50,6,"name"],[49,12,50,10],[49,14,50,12],[49,38,50,36],[50,8,51,6,"query"],[50,13,51,11],[50,15,51,13,"query"],[50,20,51,18],[51,8,52,6,"subscriber"],[51,18,52,16],[51,20,52,18,"subscriber"],[52,6,53,4],[52,7,53,5],[52,8,53,6],[53,4,54,2],[53,5,54,3],[53,6,54,4],[54,4,55,2],[54,11,55,9],[54,23,55,21],[55,6,56,4,"unsubscribed"],[55,18,56,16],[55,21,56,19],[55,25,56,23],[56,6,57,4,"unsubscribe"],[56,17,57,15],[56,21,57,19,"unsubscribe"],[56,32,57,30],[56,33,57,31],[56,34,57,32],[57,4,58,2],[57,5,58,3],[58,2,59,0],[59,0,59,1],[59,3]],"functionMap":{"names":["<global>","subscribeToSimpleQuery","query.collection._fetchQuery$argument_1","emitCopy","query.collection.experimentalSubscribe$argument_0","<anonymous>"],"mappings":"AAA;ACK;sCCS;mBCY;KDE;yDEW;KFS;GDK;SIC;GJG"},"hasCjsExports":true},"type":"js/module"}]}