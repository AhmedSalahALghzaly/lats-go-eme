{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":29,"index":44},"end":{"line":3,"column":84,"index":99}}],"key":"kslwqCIsh6ew+I1KeA1rlVRjsAk=","exportNames":["*"],"imports":1}},{"name":"./encodeQuery","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":7,"column":42,"index":244},"end":{"line":7,"column":66,"index":268}}],"key":"Vb2mqFawEJgX2CBFzkfEIWChDJQ=","exportNames":["*"],"imports":1}},{"name":"./performJoins","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":8,"column":43,"index":314},"end":{"line":8,"column":68,"index":339}}],"key":"kUYLdibenx2lYjaibempaj6dWrU=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  exports.__esModule = true;\n  exports.executeCount = executeCount;\n  exports.executeQuery = executeQuery;\n  var _encodeQuery = _interopRequireDefault(require(_dependencyMap[1], \"./encodeQuery\"));\n  var _performJoins = _interopRequireDefault(require(_dependencyMap[2], \"./performJoins\"));\n  // Finds IDs of matching records on foreign table\n  function performJoin(join, loki) {\n    var table = join.table,\n      query = join.query;\n    var collection = loki.getCollection(table).chain();\n    var records = collection.find(query).data();\n    return records;\n  }\n  function performQuery(query, loki) {\n    // Step one: perform all inner queries (JOINs) to get the single table query\n    var lokiQuery = (0, _encodeQuery.default)(query);\n    var mainQuery = (0, _performJoins.default)(lokiQuery, function (join) {\n      return performJoin(join, loki);\n    });\n\n    // Step two: fetch all records matching query\n    var collection = loki.getCollection(query.table).chain();\n    var resultset = collection.find(mainQuery);\n\n    // Step three: sort, skip, take\n    var _query$description = query.description,\n      sortBy = _query$description.sortBy,\n      take = _query$description.take,\n      skip = _query$description.skip;\n    if (sortBy.length) {\n      resultset = resultset.compoundsort(sortBy.map(function (_ref) {\n        var sortColumn = _ref.sortColumn,\n          sortOrder = _ref.sortOrder;\n        return [sortColumn, 'desc' === sortOrder];\n      }));\n    }\n    if (skip) {\n      resultset = resultset.offset(skip);\n    }\n    if (take) {\n      resultset = resultset.limit(take);\n    }\n    return resultset;\n  }\n  function executeQuery(query, loki) {\n    var lokiTransform = query.description.lokiTransform;\n    var results = performQuery(query, loki).data();\n    if (lokiTransform) {\n      return lokiTransform(results, loki);\n    }\n    return results;\n  }\n  function executeCount(query, loki) {\n    var lokiTransform = query.description.lokiTransform;\n    var resultset = performQuery(query, loki);\n    if (lokiTransform) {\n      var records = lokiTransform(resultset.data(), loki);\n      return records.length;\n    }\n    return resultset.count();\n  }\n});","lineCount":66,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0],[4,6,3,4,"_interopRequireDefault"],[4,28,3,26],[4,31,3,29,"require"],[4,38,3,36],[4,39,3,36,"_dependencyMap"],[4,53,3,36],[4,104,3,83],[4,105,3,84],[5,2,4,0,"exports"],[5,9,4,7],[5,10,4,8,"__esModule"],[5,20,4,18],[5,23,4,21],[5,27,4,25],[6,2,5,0,"exports"],[6,9,5,7],[6,10,5,8,"executeCount"],[6,22,5,20],[6,25,5,23,"executeCount"],[6,37,5,35],[7,2,6,0,"exports"],[7,9,6,7],[7,10,6,8,"executeQuery"],[7,22,6,20],[7,25,6,23,"executeQuery"],[7,37,6,35],[8,2,7,0],[8,6,7,4,"_encodeQuery"],[8,18,7,16],[8,21,7,19,"_interopRequireDefault"],[8,43,7,41],[8,44,7,42,"require"],[8,51,7,49],[8,52,7,49,"_dependencyMap"],[8,66,7,49],[8,86,7,65],[8,87,7,66],[8,88,7,67],[9,2,8,0],[9,6,8,4,"_performJoins"],[9,19,8,17],[9,22,8,20,"_interopRequireDefault"],[9,44,8,42],[9,45,8,43,"require"],[9,52,8,50],[9,53,8,50,"_dependencyMap"],[9,67,8,50],[9,88,8,67],[9,89,8,68],[9,90,8,69],[10,2,9,0],[11,2,10,0],[11,11,10,9,"performJoin"],[11,22,10,20,"performJoin"],[11,23,10,21,"join"],[11,27,10,25],[11,29,10,27,"loki"],[11,33,10,31],[11,35,10,33],[12,4,11,2],[12,8,12,11,"table"],[12,13,12,16],[12,16,14,6,"join"],[12,20,14,10],[12,21,12,4,"table"],[12,26,12,9],[13,6,13,11,"query"],[13,11,13,16],[13,14,14,6,"join"],[13,18,14,10],[13,19,13,4,"query"],[13,24,13,9],[14,4,15,2],[14,8,15,6,"collection"],[14,18,15,16],[14,21,15,19,"loki"],[14,25,15,23],[14,26,15,24,"getCollection"],[14,39,15,37],[14,40,15,38,"table"],[14,45,15,43],[14,46,15,44],[14,47,15,45,"chain"],[14,52,15,50],[14,53,15,51],[14,54,15,52],[15,4,16,2],[15,8,16,6,"records"],[15,15,16,13],[15,18,16,16,"collection"],[15,28,16,26],[15,29,16,27,"find"],[15,33,16,31],[15,34,16,32,"query"],[15,39,16,37],[15,40,16,38],[15,41,16,39,"data"],[15,45,16,43],[15,46,16,44],[15,47,16,45],[16,4,17,2],[16,11,17,9,"records"],[16,18,17,16],[17,2,18,0],[18,2,19,0],[18,11,19,9,"performQuery"],[18,23,19,21,"performQuery"],[18,24,19,22,"query"],[18,29,19,27],[18,31,19,29,"loki"],[18,35,19,33],[18,37,19,35],[19,4,20,2],[20,4,21,2],[20,8,21,6,"lokiQuery"],[20,17,21,15],[20,20,21,18],[20,21,21,19],[20,22,21,20],[20,24,21,22,"_encodeQuery"],[20,36,21,34],[20,37,21,35,"default"],[20,44,21,42],[20,46,21,44,"query"],[20,51,21,49],[20,52,21,50],[21,4,22,2],[21,8,22,6,"mainQuery"],[21,17,22,15],[21,20,22,18],[21,21,22,19],[21,22,22,20],[21,24,22,22,"_performJoins"],[21,37,22,35],[21,38,22,36,"default"],[21,45,22,43],[21,47,22,45,"lokiQuery"],[21,56,22,54],[21,58,22,56],[21,68,22,66,"join"],[21,72,22,70],[21,74,22,72],[22,6,23,4],[22,13,23,11,"performJoin"],[22,24,23,22],[22,25,23,23,"join"],[22,29,23,27],[22,31,23,29,"loki"],[22,35,23,33],[22,36,23,34],[23,4,24,2],[23,5,24,3],[23,6,24,4],[25,4,26,2],[26,4,27,2],[26,8,27,6,"collection"],[26,18,27,16],[26,21,27,19,"loki"],[26,25,27,23],[26,26,27,24,"getCollection"],[26,39,27,37],[26,40,27,38,"query"],[26,45,27,43],[26,46,27,44,"table"],[26,51,27,49],[26,52,27,50],[26,53,27,51,"chain"],[26,58,27,56],[26,59,27,57],[26,60,27,58],[27,4,28,2],[27,8,28,6,"resultset"],[27,17,28,15],[27,20,28,18,"collection"],[27,30,28,28],[27,31,28,29,"find"],[27,35,28,33],[27,36,28,34,"mainQuery"],[27,45,28,43],[27,46,28,44],[29,4,30,2],[30,4,31,2],[30,8,31,2,"_query$description"],[30,26,31,2],[30,29,35,6,"query"],[30,34,35,11],[30,35,35,12,"description"],[30,46,35,23],[31,6,32,12,"sortBy"],[31,12,32,18],[31,15,32,18,"_query$description"],[31,33,32,18],[31,34,32,4,"sortBy"],[31,40,32,10],[32,6,33,10,"take"],[32,10,33,14],[32,13,33,14,"_query$description"],[32,31,33,14],[32,32,33,4,"take"],[32,36,33,8],[33,6,34,10,"skip"],[33,10,34,14],[33,13,34,14,"_query$description"],[33,31,34,14],[33,32,34,4,"skip"],[33,36,34,8],[34,4,36,2],[34,8,36,6,"sortBy"],[34,14,36,12],[34,15,36,13,"length"],[34,21,36,19],[34,23,36,21],[35,6,37,4,"resultset"],[35,15,37,13],[35,18,37,16,"resultset"],[35,27,37,25],[35,28,37,26,"compoundsort"],[35,40,37,38],[35,41,37,39,"sortBy"],[35,47,37,45],[35,48,37,46,"map"],[35,51,37,49],[35,52,37,50],[35,62,37,50,"_ref"],[35,66,37,50],[35,68,40,7],[36,8,40,7],[36,12,38,18,"sortColumn"],[36,22,38,28],[36,25,38,28,"_ref"],[36,29,38,28],[36,30,38,6,"sortColumn"],[36,40,38,16],[37,10,39,17,"sortOrder"],[37,19,39,26],[37,22,39,26,"_ref"],[37,26,39,26],[37,27,39,6,"sortOrder"],[37,36,39,15],[38,8,41,6],[38,15,41,13],[38,16,41,14,"sortColumn"],[38,26,41,24],[38,28,41,26],[38,34,41,32],[38,39,41,37,"sortOrder"],[38,48,41,46],[38,49,41,47],[39,6,42,4],[39,7,42,5],[39,8,42,6],[39,9,42,7],[40,4,43,2],[41,4,44,2],[41,8,44,6,"skip"],[41,12,44,10],[41,14,44,12],[42,6,45,4,"resultset"],[42,15,45,13],[42,18,45,16,"resultset"],[42,27,45,25],[42,28,45,26,"offset"],[42,34,45,32],[42,35,45,33,"skip"],[42,39,45,37],[42,40,45,38],[43,4,46,2],[44,4,47,2],[44,8,47,6,"take"],[44,12,47,10],[44,14,47,12],[45,6,48,4,"resultset"],[45,15,48,13],[45,18,48,16,"resultset"],[45,27,48,25],[45,28,48,26,"limit"],[45,33,48,31],[45,34,48,32,"take"],[45,38,48,36],[45,39,48,37],[46,4,49,2],[47,4,50,2],[47,11,50,9,"resultset"],[47,20,50,18],[48,2,51,0],[49,2,52,0],[49,11,52,9,"executeQuery"],[49,23,52,21,"executeQuery"],[49,24,52,22,"query"],[49,29,52,27],[49,31,52,29,"loki"],[49,35,52,33],[49,37,52,35],[50,4,53,2],[50,8,54,19,"lokiTransform"],[50,21,54,32],[50,24,55,6,"query"],[50,29,55,11],[50,30,55,12,"description"],[50,41,55,23],[50,42,54,4,"lokiTransform"],[50,55,54,17],[51,4,56,2],[51,8,56,6,"results"],[51,15,56,13],[51,18,56,16,"performQuery"],[51,30,56,28],[51,31,56,29,"query"],[51,36,56,34],[51,38,56,36,"loki"],[51,42,56,40],[51,43,56,41],[51,44,56,42,"data"],[51,48,56,46],[51,49,56,47],[51,50,56,48],[52,4,57,2],[52,8,57,6,"lokiTransform"],[52,21,57,19],[52,23,57,21],[53,6,58,4],[53,13,58,11,"lokiTransform"],[53,26,58,24],[53,27,58,25,"results"],[53,34,58,32],[53,36,58,34,"loki"],[53,40,58,38],[53,41,58,39],[54,4,59,2],[55,4,60,2],[55,11,60,9,"results"],[55,18,60,16],[56,2,61,0],[57,2,62,0],[57,11,62,9,"executeCount"],[57,23,62,21,"executeCount"],[57,24,62,22,"query"],[57,29,62,27],[57,31,62,29,"loki"],[57,35,62,33],[57,37,62,35],[58,4,63,2],[58,8,64,19,"lokiTransform"],[58,21,64,32],[58,24,65,6,"query"],[58,29,65,11],[58,30,65,12,"description"],[58,41,65,23],[58,42,64,4,"lokiTransform"],[58,55,64,17],[59,4,66,2],[59,8,66,6,"resultset"],[59,17,66,15],[59,20,66,18,"performQuery"],[59,32,66,30],[59,33,66,31,"query"],[59,38,66,36],[59,40,66,38,"loki"],[59,44,66,42],[59,45,66,43],[60,4,67,2],[60,8,67,6,"lokiTransform"],[60,21,67,19],[60,23,67,21],[61,6,68,4],[61,10,68,8,"records"],[61,17,68,15],[61,20,68,18,"lokiTransform"],[61,33,68,31],[61,34,68,32,"resultset"],[61,43,68,41],[61,44,68,42,"data"],[61,48,68,46],[61,49,68,47],[61,50,68,48],[61,52,68,50,"loki"],[61,56,68,54],[61,57,68,55],[62,6,69,4],[62,13,69,11,"records"],[62,20,69,18],[62,21,69,19,"length"],[62,27,69,25],[63,4,70,2],[64,4,71,2],[64,11,71,9,"resultset"],[64,20,71,18],[64,21,71,19,"count"],[64,26,71,24],[64,27,71,25],[64,28,71,26],[65,2,72,0],[66,0,72,1],[66,3]],"functionMap":{"names":["<global>","performJoin","performQuery","<anonymous>","sortBy.map$argument_0","executeQuery","executeCount"],"mappings":"AAA;ACS;CDQ;AEC;wDCG;GDE;kDEa;KFK;CFS;AKC;CLS;AMC"},"hasCjsExports":true},"type":"js/module"}]}