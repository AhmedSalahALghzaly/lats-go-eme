{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":29,"index":44},"end":{"line":3,"column":84,"index":99}}],"key":"kslwqCIsh6ew+I1KeA1rlVRjsAk=","exportNames":["*"],"imports":1}},{"name":"../utils/common/logger","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":6,"column":37,"index":191},"end":{"line":6,"column":70,"index":224}}],"key":"VryVzzhBa1bGcKcurcOH2zeAFWQ=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  exports.__esModule = true;\n  exports.default = void 0;\n  var _logger = _interopRequireDefault(require(_dependencyMap[1], \"../utils/common/logger\"));\n  var RecordCache = exports.default = /*#__PURE__*/function () {\n    function RecordCache(tableName, recordInsantiator, collection) {\n      this.map = new Map();\n      this.tableName = tableName;\n      this.recordInsantiator = recordInsantiator;\n      this._debugCollection = collection;\n    }\n    var _proto = RecordCache.prototype;\n    _proto.get = function (id) {\n      return this.map.get(id);\n    };\n    _proto.add = function (record) {\n      this.map.set(record.id, record);\n    };\n    _proto.delete = function (record) {\n      this.map.delete(record.id);\n    };\n    _proto.unsafeClear = function () {\n      this.map = new Map();\n    };\n    _proto.recordsFromQueryResult = function (result) {\n      var _this = this;\n      return result.map(function (res) {\n        return _this.recordFromQueryResult(res);\n      });\n    };\n    _proto.recordFromQueryResult = function (result) {\n      if ('string' === typeof result) {\n        return this._cachedModelForId(result);\n      }\n      return this._modelForRaw(result);\n    };\n    _proto.rawRecordsFromQueryResult = function (results) {\n      var _this2 = this;\n      return results.map(function (res) {\n        if ('string' === typeof res) {\n          return _this2._cachedModelForId(res)._raw;\n        }\n        var cachedRecord = _this2.map.get(res.id);\n        return cachedRecord ? cachedRecord._raw : res;\n      });\n    };\n    _proto._cachedModelForId = function (id) {\n      var record = this.map.get(id);\n      if (!record) {\n        var message = \"Record ID \".concat(this.tableName, \"#\").concat(id, \" was sent over the bridge, but it's not cached\");\n        _logger.default.error(message);\n\n        // Reaching this branch indicates a WatermelonDB/adapter bug. We should never get a record ID\n        // if we don't have it in our cache. This probably means that something crashed when adding to\n        // adapter-side cached record ID set. NozbeTeams telemetry indicates that this bug *does*\n        // nonetheless occur, so when it does, print out useful diagnostics and attempt to recover by\n        // resetting adapter-side cached set\n        try {\n          var adapter = this._debugCollection.database.adapter.underlyingAdapter;\n\n          // $FlowFixMe\n          if (adapter._clearCachedRecords) {\n            // $FlowFixMe\n            adapter._clearCachedRecords();\n          }\n\n          // $FlowFixMe\n          if (adapter._debugDignoseMissingRecord) {\n            // $FlowFixMe\n            adapter._debugDignoseMissingRecord(this.tableName, id);\n          }\n        } catch (error) {\n          _logger.default.warn(\"Ran into an error while running diagnostics:\");\n          _logger.default.warn(error);\n        }\n        throw new Error(message);\n      }\n      return record;\n    };\n    _proto._modelForRaw = function (raw, warnIfCached = true) {\n      // Sanity check: is this already cached?\n      var cachedRecord = this.map.get(raw.id);\n      if (cachedRecord) {\n        // This may legitimately happen if we previously got ID without a record and we cleared\n        // adapter-side cached record ID maps to recover\n        warnIfCached && _logger.default.warn(\"Record \".concat(this.tableName, \"#\").concat(cachedRecord.id, \" is cached, but full raw object was sent over the bridge\"));\n        return cachedRecord;\n      }\n\n      // Return new model\n      var newRecord = this.recordInsantiator(raw);\n      this.add(newRecord);\n      return newRecord;\n    };\n    return RecordCache;\n  }();\n});","lineCount":100,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0],[4,6,3,4,"_interopRequireDefault"],[4,28,3,26],[4,31,3,29,"require"],[4,38,3,36],[4,39,3,36,"_dependencyMap"],[4,53,3,36],[4,104,3,83],[4,105,3,84],[5,2,4,0,"exports"],[5,9,4,7],[5,10,4,8,"__esModule"],[5,20,4,18],[5,23,4,21],[5,27,4,25],[6,2,5,0,"exports"],[6,9,5,7],[6,10,5,8,"default"],[6,17,5,15],[6,20,5,18],[6,25,5,23],[6,26,5,24],[7,2,6,0],[7,6,6,4,"_logger"],[7,13,6,11],[7,16,6,14,"_interopRequireDefault"],[7,38,6,36],[7,39,6,37,"require"],[7,46,6,44],[7,47,6,44,"_dependencyMap"],[7,61,6,44],[7,90,6,69],[7,91,6,70],[7,92,6,71],[8,2,7,0],[8,6,7,4,"RecordCache"],[8,17,7,15],[8,20,7,18,"exports"],[8,27,7,25],[8,28,7,26,"default"],[8,35,7,33],[8,38,7,36],[8,51,7,49],[8,63,7,61],[9,4,8,2],[9,13,8,11,"RecordCache"],[9,24,8,22,"RecordCache"],[9,25,8,23,"tableName"],[9,34,8,32],[9,36,8,34,"recordInsantiator"],[9,53,8,51],[9,55,8,53,"collection"],[9,65,8,63],[9,67,8,65],[10,6,9,4],[10,10,9,8],[10,11,9,9,"map"],[10,14,9,12],[10,17,9,15],[10,21,9,19,"Map"],[10,24,9,22],[10,25,9,23],[10,26,9,24],[11,6,10,4],[11,10,10,8],[11,11,10,9,"tableName"],[11,20,10,18],[11,23,10,21,"tableName"],[11,32,10,30],[12,6,11,4],[12,10,11,8],[12,11,11,9,"recordInsantiator"],[12,28,11,26],[12,31,11,29,"recordInsantiator"],[12,48,11,46],[13,6,12,4],[13,10,12,8],[13,11,12,9,"_debugCollection"],[13,27,12,25],[13,30,12,28,"collection"],[13,40,12,38],[14,4,13,2],[15,4,14,2],[15,8,14,6,"_proto"],[15,14,14,12],[15,17,14,15,"RecordCache"],[15,28,14,26],[15,29,14,27,"prototype"],[15,38,14,36],[16,4,15,2,"_proto"],[16,10,15,8],[16,11,15,9,"get"],[16,14,15,12],[16,17,15,15],[16,27,15,25,"id"],[16,29,15,27],[16,31,15,29],[17,6,16,4],[17,13,16,11],[17,17,16,15],[17,18,16,16,"map"],[17,21,16,19],[17,22,16,20,"get"],[17,25,16,23],[17,26,16,24,"id"],[17,28,16,26],[17,29,16,27],[18,4,17,2],[18,5,17,3],[19,4,18,2,"_proto"],[19,10,18,8],[19,11,18,9,"add"],[19,14,18,12],[19,17,18,15],[19,27,18,25,"record"],[19,33,18,31],[19,35,18,33],[20,6,19,4],[20,10,19,8],[20,11,19,9,"map"],[20,14,19,12],[20,15,19,13,"set"],[20,18,19,16],[20,19,19,17,"record"],[20,25,19,23],[20,26,19,24,"id"],[20,28,19,26],[20,30,19,28,"record"],[20,36,19,34],[20,37,19,35],[21,4,20,2],[21,5,20,3],[22,4,21,2,"_proto"],[22,10,21,8],[22,11,21,9,"delete"],[22,17,21,15],[22,20,21,18],[22,30,21,28,"record"],[22,36,21,34],[22,38,21,36],[23,6,22,4],[23,10,22,8],[23,11,22,9,"map"],[23,14,22,12],[23,15,22,13,"delete"],[23,21,22,19],[23,22,22,20,"record"],[23,28,22,26],[23,29,22,27,"id"],[23,31,22,29],[23,32,22,30],[24,4,23,2],[24,5,23,3],[25,4,24,2,"_proto"],[25,10,24,8],[25,11,24,9,"unsafeClear"],[25,22,24,20],[25,25,24,23],[25,37,24,35],[26,6,25,4],[26,10,25,8],[26,11,25,9,"map"],[26,14,25,12],[26,17,25,15],[26,21,25,19,"Map"],[26,24,25,22],[26,25,25,23],[26,26,25,24],[27,4,26,2],[27,5,26,3],[28,4,27,2,"_proto"],[28,10,27,8],[28,11,27,9,"recordsFromQueryResult"],[28,33,27,31],[28,36,27,34],[28,46,27,44,"result"],[28,52,27,50],[28,54,27,52],[29,6,28,4],[29,10,28,8,"_this"],[29,15,28,13],[29,18,28,16],[29,22,28,20],[30,6,29,4],[30,13,29,11,"result"],[30,19,29,17],[30,20,29,18,"map"],[30,23,29,21],[30,24,29,22],[30,34,29,32,"res"],[30,37,29,35],[30,39,29,37],[31,8,30,6],[31,15,30,13,"_this"],[31,20,30,18],[31,21,30,19,"recordFromQueryResult"],[31,42,30,40],[31,43,30,41,"res"],[31,46,30,44],[31,47,30,45],[32,6,31,4],[32,7,31,5],[32,8,31,6],[33,4,32,2],[33,5,32,3],[34,4,33,2,"_proto"],[34,10,33,8],[34,11,33,9,"recordFromQueryResult"],[34,32,33,30],[34,35,33,33],[34,45,33,43,"result"],[34,51,33,49],[34,53,33,51],[35,6,34,4],[35,10,34,8],[35,18,34,16],[35,23,34,21],[35,30,34,28,"result"],[35,36,34,34],[35,38,34,36],[36,8,35,6],[36,15,35,13],[36,19,35,17],[36,20,35,18,"_cachedModelForId"],[36,37,35,35],[36,38,35,36,"result"],[36,44,35,42],[36,45,35,43],[37,6,36,4],[38,6,37,4],[38,13,37,11],[38,17,37,15],[38,18,37,16,"_modelForRaw"],[38,30,37,28],[38,31,37,29,"result"],[38,37,37,35],[38,38,37,36],[39,4,38,2],[39,5,38,3],[40,4,39,2,"_proto"],[40,10,39,8],[40,11,39,9,"rawRecordsFromQueryResult"],[40,36,39,34],[40,39,39,37],[40,49,39,47,"results"],[40,56,39,54],[40,58,39,56],[41,6,40,4],[41,10,40,8,"_this2"],[41,16,40,14],[41,19,40,17],[41,23,40,21],[42,6,41,4],[42,13,41,11,"results"],[42,20,41,18],[42,21,41,19,"map"],[42,24,41,22],[42,25,41,23],[42,35,41,33,"res"],[42,38,41,36],[42,40,41,38],[43,8,42,6],[43,12,42,10],[43,20,42,18],[43,25,42,23],[43,32,42,30,"res"],[43,35,42,33],[43,37,42,35],[44,10,43,8],[44,17,43,15,"_this2"],[44,23,43,21],[44,24,43,22,"_cachedModelForId"],[44,41,43,39],[44,42,43,40,"res"],[44,45,43,43],[44,46,43,44],[44,47,43,45,"_raw"],[44,51,43,49],[45,8,44,6],[46,8,45,6],[46,12,45,10,"cachedRecord"],[46,24,45,22],[46,27,45,25,"_this2"],[46,33,45,31],[46,34,45,32,"map"],[46,37,45,35],[46,38,45,36,"get"],[46,41,45,39],[46,42,45,40,"res"],[46,45,45,43],[46,46,45,44,"id"],[46,48,45,46],[46,49,45,47],[47,8,46,6],[47,15,46,13,"cachedRecord"],[47,27,46,25],[47,30,46,28,"cachedRecord"],[47,42,46,40],[47,43,46,41,"_raw"],[47,47,46,45],[47,50,46,48,"res"],[47,53,46,51],[48,6,47,4],[48,7,47,5],[48,8,47,6],[49,4,48,2],[49,5,48,3],[50,4,49,2,"_proto"],[50,10,49,8],[50,11,49,9,"_cachedModelForId"],[50,28,49,26],[50,31,49,29],[50,41,49,39,"id"],[50,43,49,41],[50,45,49,43],[51,6,50,4],[51,10,50,8,"record"],[51,16,50,14],[51,19,50,17],[51,23,50,21],[51,24,50,22,"map"],[51,27,50,25],[51,28,50,26,"get"],[51,31,50,29],[51,32,50,30,"id"],[51,34,50,32],[51,35,50,33],[52,6,51,4],[52,10,51,8],[52,11,51,9,"record"],[52,17,51,15],[52,19,51,17],[53,8,52,6],[53,12,52,10,"message"],[53,19,52,17],[53,22,52,20],[53,34,52,32],[53,35,52,33,"concat"],[53,41,52,39],[53,42,52,40],[53,46,52,44],[53,47,52,45,"tableName"],[53,56,52,54],[53,58,52,56],[53,61,52,59],[53,62,52,60],[53,63,52,61,"concat"],[53,69,52,67],[53,70,52,68,"id"],[53,72,52,70],[53,74,52,72],[53,122,52,120],[53,123,52,121],[54,8,53,6,"_logger"],[54,15,53,13],[54,16,53,14,"default"],[54,23,53,21],[54,24,53,22,"error"],[54,29,53,27],[54,30,53,28,"message"],[54,37,53,35],[54,38,53,36],[56,8,55,6],[57,8,56,6],[58,8,57,6],[59,8,58,6],[60,8,59,6],[61,8,60,6],[61,12,60,10],[62,10,61,8],[62,14,61,12,"adapter"],[62,21,61,19],[62,24,61,22],[62,28,61,26],[62,29,61,27,"_debugCollection"],[62,45,61,43],[62,46,61,44,"database"],[62,54,61,52],[62,55,61,53,"adapter"],[62,62,61,60],[62,63,61,61,"underlyingAdapter"],[62,80,61,78],[64,10,63,8],[65,10,64,8],[65,14,64,12,"adapter"],[65,21,64,19],[65,22,64,20,"_clearCachedRecords"],[65,41,64,39],[65,43,64,41],[66,12,65,10],[67,12,66,10,"adapter"],[67,19,66,17],[67,20,66,18,"_clearCachedRecords"],[67,39,66,37],[67,40,66,38],[67,41,66,39],[68,10,67,8],[70,10,69,8],[71,10,70,8],[71,14,70,12,"adapter"],[71,21,70,19],[71,22,70,20,"_debugDignoseMissingRecord"],[71,48,70,46],[71,50,70,48],[72,12,71,10],[73,12,72,10,"adapter"],[73,19,72,17],[73,20,72,18,"_debugDignoseMissingRecord"],[73,46,72,44],[73,47,72,45],[73,51,72,49],[73,52,72,50,"tableName"],[73,61,72,59],[73,63,72,61,"id"],[73,65,72,63],[73,66,72,64],[74,10,73,8],[75,8,74,6],[75,9,74,7],[75,10,74,8],[75,17,74,15,"error"],[75,22,74,20],[75,24,74,22],[76,10,75,8,"_logger"],[76,17,75,15],[76,18,75,16,"default"],[76,25,75,23],[76,26,75,24,"warn"],[76,30,75,28],[76,31,75,29],[76,77,75,75],[76,78,75,76],[77,10,76,8,"_logger"],[77,17,76,15],[77,18,76,16,"default"],[77,25,76,23],[77,26,76,24,"warn"],[77,30,76,28],[77,31,76,29,"error"],[77,36,76,34],[77,37,76,35],[78,8,77,6],[79,8,78,6],[79,14,78,12],[79,18,78,16,"Error"],[79,23,78,21],[79,24,78,22,"message"],[79,31,78,29],[79,32,78,30],[80,6,79,4],[81,6,80,4],[81,13,80,11,"record"],[81,19,80,17],[82,4,81,2],[82,5,81,3],[83,4,82,2,"_proto"],[83,10,82,8],[83,11,82,9,"_modelForRaw"],[83,23,82,21],[83,26,82,24],[83,36,82,34,"raw"],[83,39,82,37],[83,41,82,39,"warnIfCached"],[83,53,82,51],[83,56,82,54],[83,60,82,58],[83,62,82,60],[84,6,83,4],[85,6,84,4],[85,10,84,8,"cachedRecord"],[85,22,84,20],[85,25,84,23],[85,29,84,27],[85,30,84,28,"map"],[85,33,84,31],[85,34,84,32,"get"],[85,37,84,35],[85,38,84,36,"raw"],[85,41,84,39],[85,42,84,40,"id"],[85,44,84,42],[85,45,84,43],[86,6,85,4],[86,10,85,8,"cachedRecord"],[86,22,85,20],[86,24,85,22],[87,8,86,6],[88,8,87,6],[89,8,88,6,"warnIfCached"],[89,20,88,18],[89,24,88,22,"_logger"],[89,31,88,29],[89,32,88,30,"default"],[89,39,88,37],[89,40,88,38,"warn"],[89,44,88,42],[89,45,88,43],[89,54,88,52],[89,55,88,53,"concat"],[89,61,88,59],[89,62,88,60],[89,66,88,64],[89,67,88,65,"tableName"],[89,76,88,74],[89,78,88,76],[89,81,88,79],[89,82,88,80],[89,83,88,81,"concat"],[89,89,88,87],[89,90,88,88,"cachedRecord"],[89,102,88,100],[89,103,88,101,"id"],[89,105,88,103],[89,107,88,105],[89,165,88,163],[89,166,88,164],[89,167,88,165],[90,8,89,6],[90,15,89,13,"cachedRecord"],[90,27,89,25],[91,6,90,4],[93,6,92,4],[94,6,93,4],[94,10,93,8,"newRecord"],[94,19,93,17],[94,22,93,20],[94,26,93,24],[94,27,93,25,"recordInsantiator"],[94,44,93,42],[94,45,93,43,"raw"],[94,48,93,46],[94,49,93,47],[95,6,94,4],[95,10,94,8],[95,11,94,9,"add"],[95,14,94,12],[95,15,94,13,"newRecord"],[95,24,94,22],[95,25,94,23],[96,6,95,4],[96,13,95,11,"newRecord"],[96,22,95,20],[97,4,96,2],[97,5,96,3],[98,4,97,2],[98,11,97,9,"RecordCache"],[98,22,97,20],[99,2,98,0],[99,3,98,1],[99,4,98,2],[99,5,98,3],[100,0,98,4],[100,3]],"functionMap":{"names":["<global>","<anonymous>","RecordCache","_proto.get","_proto.add","_proto._delete","_proto.unsafeClear","_proto.recordsFromQueryResult","result.map$argument_0","_proto.recordFromQueryResult","_proto.rawRecordsFromQueryResult","results.map$argument_0","_proto._cachedModelForId","_proto._modelForRaw"],"mappings":"AAA;iDCM;ECC;GDK;eEE;GFE;eGC;GHE;kBIC;GJE;uBKC;GLE;kCMC;sBCE;KDE;GNC;iCQC;GRK;qCSC;uBCE;KDM;GTC;6BWC;GXgC;wBYC;GZc;CDE"},"hasCjsExports":true},"type":"js/module"}]}