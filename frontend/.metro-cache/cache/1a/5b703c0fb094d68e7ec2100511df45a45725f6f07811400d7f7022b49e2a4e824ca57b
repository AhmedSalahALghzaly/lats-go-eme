{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":29,"index":44},"end":{"line":3,"column":84,"index":99}}],"key":"kslwqCIsh6ew+I1KeA1rlVRjsAk=","exportNames":["*"],"imports":1}},{"name":"../utils/common/randomId","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":8,"column":39,"index":278},"end":{"line":8,"column":74,"index":313}}],"key":"5prJ5zgoK/519n3OgQgOvolJ+eo=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  exports.__esModule = true;\n  exports.nullValue = nullValue;\n  exports.sanitizedRaw = sanitizedRaw;\n  exports.setRawSanitized = setRawSanitized;\n  var _randomId = _interopRequireDefault(require(_dependencyMap[1], \"../utils/common/randomId\"));\n  /* eslint-disable no-lonely-if */\n  /* eslint-disable no-self-compare */\n  // Raw object representing a model record, coming from an untrusted source\n  // (disk, sync, user data). Before it can be used to create a Model instance\n  // it must be sanitized (with `sanitizedRaw`) into a RawRecord\n  // These fields are ALWAYS present in records of any collection.\n  // Raw object representing a model record. A RawRecord is guaranteed by the type system\n  // to be safe to use (sanitied with `sanitizedRaw`):\n  // - it has exactly the fields described by TableSchema (+ standard fields)\n  // - every field is exactly the type described by ColumnSchema (string, number, or boolean)\n  // - … and the same optionality (will not be null unless isOptional: true)\n  // a number, but not NaN (NaN !== NaN) or Infinity\n  function isValidNumber(value) {\n    return 'number' === typeof value && value === value && value !== Infinity && value !== -Infinity;\n  }\n\n  // Note: This is performance-critical code\n  function _setRaw(raw, key, value, columnSchema) {\n    var {\n      type: type,\n      isOptional: isOptional\n    } = columnSchema;\n\n    // If the value is wrong type or invalid, it's set to `null` (if optional) or empty value ('', 0, false)\n    if ('string' === type) {\n      if ('string' === typeof value) {\n        raw[key] = value;\n      } else {\n        raw[key] = isOptional ? null : '';\n      }\n    } else if ('boolean' === type) {\n      if ('boolean' === typeof value) {\n        raw[key] = value;\n      } else if (1 === value || 0 === value) {\n        // Exception to the standard rule — because SQLite turns true/false into 1/0\n        raw[key] = Boolean(value);\n      } else {\n        raw[key] = isOptional ? null : false;\n      }\n    } else {\n      // type = number\n      // Treat NaN and Infinity as null\n      if (isValidNumber(value)) {\n        raw[key] = value || 0;\n      } else {\n        raw[key] = isOptional ? null : 0;\n      }\n    }\n  }\n  function isValidStatus(value) {\n    return 'created' === value || 'updated' === value || 'deleted' === value || 'synced' === value;\n  }\n\n  // Transforms a dirty raw record object into a trusted sanitized RawRecord according to passed TableSchema\n  // TODO: Should we make this public API for advanced users?\n  function sanitizedRaw(dirtyRaw, tableSchema) {\n    var {\n      id: id,\n      _status: _status,\n      _changed: _changed\n    } = dirtyRaw;\n\n    // This is called with `{}` when making a new record, so we need to set a new ID, status\n    // Also: If an existing has one of those fields broken, we're screwed. Safest to treat it as a\n    // new record (so that it gets synced)\n\n    // TODO: Think about whether prototypeless objects are a useful mitigation\n    // const raw = Object.create(null) // create a prototypeless object\n    var raw = {};\n    if ('string' === typeof id) {\n      // TODO: Can we trust IDs passed? Maybe we want to split this implementation, depending on whether\n      // this is used on implicitly-trusted (persisted or Watermelon-created) records, or if this is user input?\n      raw.id = id;\n      raw._status = isValidStatus(_status) ? _status : 'created';\n      raw._changed = 'string' === typeof _changed ? _changed : '';\n    } else {\n      raw.id = (0, _randomId.default)();\n      raw._status = 'created';\n      raw._changed = '';\n    }\n\n    // faster than Object.values on a map\n    var columns = tableSchema.columnArray;\n    for (var i = 0, len = columns.length; i < len; i += 1) {\n      var columnSchema = columns[i];\n      var key = columnSchema.name;\n      // TODO: Check performance\n      // $FlowFixMe\n      var value = Object.prototype.hasOwnProperty.call(dirtyRaw, key) ? dirtyRaw[key] : null;\n      _setRaw(raw, key, value, columnSchema);\n    }\n    return raw;\n  }\n\n  // Modifies passed rawRecord by setting sanitized `value` to `columnName`\n  // Note: Assumes columnName exists and columnSchema matches the name\n  function setRawSanitized(rawRecord, columnName, value, columnSchema) {\n    _setRaw(rawRecord, columnName, value, columnSchema);\n  }\n  function nullValue(columnSchema) {\n    var {\n      isOptional: isOptional,\n      type: type\n    } = columnSchema;\n    if (isOptional) {\n      return null;\n    } else if ('string' === type) {\n      return '';\n    } else if ('number' === type) {\n      return 0;\n    } else if ('boolean' === type) {\n      return false;\n    }\n    throw new Error(\"Unknown type for column schema \".concat(JSON.stringify(columnSchema)));\n  }\n});","lineCount":125,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0],[4,6,3,4,"_interopRequireDefault"],[4,28,3,26],[4,31,3,29,"require"],[4,38,3,36],[4,39,3,36,"_dependencyMap"],[4,53,3,36],[4,104,3,83],[4,105,3,84],[5,2,4,0,"exports"],[5,9,4,7],[5,10,4,8,"__esModule"],[5,20,4,18],[5,23,4,21],[5,27,4,25],[6,2,5,0,"exports"],[6,9,5,7],[6,10,5,8,"nullValue"],[6,19,5,17],[6,22,5,20,"nullValue"],[6,31,5,29],[7,2,6,0,"exports"],[7,9,6,7],[7,10,6,8,"sanitizedRaw"],[7,22,6,20],[7,25,6,23,"sanitizedRaw"],[7,37,6,35],[8,2,7,0,"exports"],[8,9,7,7],[8,10,7,8,"setRawSanitized"],[8,25,7,23],[8,28,7,26,"setRawSanitized"],[8,43,7,41],[9,2,8,0],[9,6,8,4,"_randomId"],[9,15,8,13],[9,18,8,16,"_interopRequireDefault"],[9,40,8,38],[9,41,8,39,"require"],[9,48,8,46],[9,49,8,46,"_dependencyMap"],[9,63,8,46],[9,94,8,73],[9,95,8,74],[9,96,8,75],[10,2,9,0],[11,2,10,0],[12,2,11,0],[13,2,12,0],[14,2,13,0],[15,2,14,0],[16,2,15,0],[17,2,16,0],[18,2,17,0],[19,2,18,0],[20,2,19,0],[21,2,20,0],[22,2,21,0],[22,11,21,9,"isValidNumber"],[22,24,21,22,"isValidNumber"],[22,25,21,23,"value"],[22,30,21,28],[22,32,21,30],[23,4,22,2],[23,11,22,9],[23,19,22,17],[23,24,22,22],[23,31,22,29,"value"],[23,36,22,34],[23,40,22,38,"value"],[23,45,22,43],[23,50,22,48,"value"],[23,55,22,53],[23,59,22,57,"value"],[23,64,22,62],[23,69,22,67,"Infinity"],[23,77,22,75],[23,81,22,79,"value"],[23,86,22,84],[23,91,22,89],[23,92,22,90,"Infinity"],[23,100,22,98],[24,2,23,0],[26,2,25,0],[27,2,26,0],[27,11,26,9,"_setRaw"],[27,18,26,16,"_setRaw"],[27,19,26,17,"raw"],[27,22,26,20],[27,24,26,22,"key"],[27,27,26,25],[27,29,26,27,"value"],[27,34,26,32],[27,36,26,34,"columnSchema"],[27,48,26,46],[27,50,26,48],[28,4,27,2],[28,8,27,6],[29,6,28,4,"type"],[29,10,28,8],[29,12,28,10,"type"],[29,16,28,14],[30,6,29,4,"isOptional"],[30,16,29,14],[30,18,29,16,"isOptional"],[31,4,30,2],[31,5,30,3],[31,8,30,6,"columnSchema"],[31,20,30,18],[33,4,32,2],[34,4,33,2],[34,8,33,6],[34,16,33,14],[34,21,33,19,"type"],[34,25,33,23],[34,27,33,25],[35,6,34,4],[35,10,34,8],[35,18,34,16],[35,23,34,21],[35,30,34,28,"value"],[35,35,34,33],[35,37,34,35],[36,8,35,6,"raw"],[36,11,35,9],[36,12,35,10,"key"],[36,15,35,13],[36,16,35,14],[36,19,35,17,"value"],[36,24,35,22],[37,6,36,4],[37,7,36,5],[37,13,36,11],[38,8,37,6,"raw"],[38,11,37,9],[38,12,37,10,"key"],[38,15,37,13],[38,16,37,14],[38,19,37,17,"isOptional"],[38,29,37,27],[38,32,37,30],[38,36,37,34],[38,39,37,37],[38,41,37,39],[39,6,38,4],[40,4,39,2],[40,5,39,3],[40,11,39,9],[40,15,39,13],[40,24,39,22],[40,29,39,27,"type"],[40,33,39,31],[40,35,39,33],[41,6,40,4],[41,10,40,8],[41,19,40,17],[41,24,40,22],[41,31,40,29,"value"],[41,36,40,34],[41,38,40,36],[42,8,41,6,"raw"],[42,11,41,9],[42,12,41,10,"key"],[42,15,41,13],[42,16,41,14],[42,19,41,17,"value"],[42,24,41,22],[43,6,42,4],[43,7,42,5],[43,13,42,11],[43,17,42,15],[43,18,42,16],[43,23,42,21,"value"],[43,28,42,26],[43,32,42,30],[43,33,42,31],[43,38,42,36,"value"],[43,43,42,41],[43,45,42,43],[44,8,43,6],[45,8,44,6,"raw"],[45,11,44,9],[45,12,44,10,"key"],[45,15,44,13],[45,16,44,14],[45,19,44,17,"Boolean"],[45,26,44,24],[45,27,44,25,"value"],[45,32,44,30],[45,33,44,31],[46,6,45,4],[46,7,45,5],[46,13,45,11],[47,8,46,6,"raw"],[47,11,46,9],[47,12,46,10,"key"],[47,15,46,13],[47,16,46,14],[47,19,46,17,"isOptional"],[47,29,46,27],[47,32,46,30],[47,36,46,34],[47,39,46,37],[47,44,46,42],[48,6,47,4],[49,4,48,2],[49,5,48,3],[49,11,48,9],[50,6,49,4],[51,6,50,4],[52,6,51,4],[52,10,51,8,"isValidNumber"],[52,23,51,21],[52,24,51,22,"value"],[52,29,51,27],[52,30,51,28],[52,32,51,30],[53,8,52,6,"raw"],[53,11,52,9],[53,12,52,10,"key"],[53,15,52,13],[53,16,52,14],[53,19,52,17,"value"],[53,24,52,22],[53,28,52,26],[53,29,52,27],[54,6,53,4],[54,7,53,5],[54,13,53,11],[55,8,54,6,"raw"],[55,11,54,9],[55,12,54,10,"key"],[55,15,54,13],[55,16,54,14],[55,19,54,17,"isOptional"],[55,29,54,27],[55,32,54,30],[55,36,54,34],[55,39,54,37],[55,40,54,38],[56,6,55,4],[57,4,56,2],[58,2,57,0],[59,2,58,0],[59,11,58,9,"isValidStatus"],[59,24,58,22,"isValidStatus"],[59,25,58,23,"value"],[59,30,58,28],[59,32,58,30],[60,4,59,2],[60,11,59,9],[60,20,59,18],[60,25,59,23,"value"],[60,30,59,28],[60,34,59,32],[60,43,59,41],[60,48,59,46,"value"],[60,53,59,51],[60,57,59,55],[60,66,59,64],[60,71,59,69,"value"],[60,76,59,74],[60,80,59,78],[60,88,59,86],[60,93,59,91,"value"],[60,98,59,96],[61,2,60,0],[63,2,62,0],[64,2,63,0],[65,2,64,0],[65,11,64,9,"sanitizedRaw"],[65,23,64,21,"sanitizedRaw"],[65,24,64,22,"dirtyRaw"],[65,32,64,30],[65,34,64,32,"tableSchema"],[65,45,64,43],[65,47,64,45],[66,4,65,2],[66,8,65,6],[67,6,66,4,"id"],[67,8,66,6],[67,10,66,8,"id"],[67,12,66,10],[68,6,67,4,"_status"],[68,13,67,11],[68,15,67,13,"_status"],[68,22,67,20],[69,6,68,4,"_changed"],[69,14,68,12],[69,16,68,14,"_changed"],[70,4,69,2],[70,5,69,3],[70,8,69,6,"dirtyRaw"],[70,16,69,14],[72,4,71,2],[73,4,72,2],[74,4,73,2],[76,4,75,2],[77,4,76,2],[78,4,77,2],[78,8,77,6,"raw"],[78,11,77,9],[78,14,77,12],[78,15,77,13],[78,16,77,14],[79,4,78,2],[79,8,78,6],[79,16,78,14],[79,21,78,19],[79,28,78,26,"id"],[79,30,78,28],[79,32,78,30],[80,6,79,4],[81,6,80,4],[82,6,81,4,"raw"],[82,9,81,7],[82,10,81,8,"id"],[82,12,81,10],[82,15,81,13,"id"],[82,17,81,15],[83,6,82,4,"raw"],[83,9,82,7],[83,10,82,8,"_status"],[83,17,82,15],[83,20,82,18,"isValidStatus"],[83,33,82,31],[83,34,82,32,"_status"],[83,41,82,39],[83,42,82,40],[83,45,82,43,"_status"],[83,52,82,50],[83,55,82,53],[83,64,82,62],[84,6,83,4,"raw"],[84,9,83,7],[84,10,83,8,"_changed"],[84,18,83,16],[84,21,83,19],[84,29,83,27],[84,34,83,32],[84,41,83,39,"_changed"],[84,49,83,47],[84,52,83,50,"_changed"],[84,60,83,58],[84,63,83,61],[84,65,83,63],[85,4,84,2],[85,5,84,3],[85,11,84,9],[86,6,85,4,"raw"],[86,9,85,7],[86,10,85,8,"id"],[86,12,85,10],[86,15,85,13],[86,16,85,14],[86,17,85,15],[86,19,85,17,"_randomId"],[86,28,85,26],[86,29,85,27,"default"],[86,36,85,34],[86,38,85,36],[86,39,85,37],[87,6,86,4,"raw"],[87,9,86,7],[87,10,86,8,"_status"],[87,17,86,15],[87,20,86,18],[87,29,86,27],[88,6,87,4,"raw"],[88,9,87,7],[88,10,87,8,"_changed"],[88,18,87,16],[88,21,87,19],[88,23,87,21],[89,4,88,2],[91,4,90,2],[92,4,91,2],[92,8,91,6,"columns"],[92,15,91,13],[92,18,91,16,"tableSchema"],[92,29,91,27],[92,30,91,28,"columnArray"],[92,41,91,39],[93,4,92,2],[93,9,92,7],[93,13,92,11,"i"],[93,14,92,12],[93,17,92,15],[93,18,92,16],[93,20,92,18,"len"],[93,23,92,21],[93,26,92,24,"columns"],[93,33,92,31],[93,34,92,32,"length"],[93,40,92,38],[93,42,92,40,"i"],[93,43,92,41],[93,46,92,44,"len"],[93,49,92,47],[93,51,92,49,"i"],[93,52,92,50],[93,56,92,54],[93,57,92,55],[93,59,92,57],[94,6,93,4],[94,10,93,8,"columnSchema"],[94,22,93,20],[94,25,93,23,"columns"],[94,32,93,30],[94,33,93,31,"i"],[94,34,93,32],[94,35,93,33],[95,6,94,4],[95,10,94,8,"key"],[95,13,94,11],[95,16,94,14,"columnSchema"],[95,28,94,26],[95,29,94,27,"name"],[95,33,94,31],[96,6,95,4],[97,6,96,4],[98,6,97,4],[98,10,97,8,"value"],[98,15,97,13],[98,18,97,16,"Object"],[98,24,97,22],[98,25,97,23,"prototype"],[98,34,97,32],[98,35,97,33,"hasOwnProperty"],[98,49,97,47],[98,50,97,48,"call"],[98,54,97,52],[98,55,97,53,"dirtyRaw"],[98,63,97,61],[98,65,97,63,"key"],[98,68,97,66],[98,69,97,67],[98,72,97,70,"dirtyRaw"],[98,80,97,78],[98,81,97,79,"key"],[98,84,97,82],[98,85,97,83],[98,88,97,86],[98,92,97,90],[99,6,98,4,"_setRaw"],[99,13,98,11],[99,14,98,12,"raw"],[99,17,98,15],[99,19,98,17,"key"],[99,22,98,20],[99,24,98,22,"value"],[99,29,98,27],[99,31,98,29,"columnSchema"],[99,43,98,41],[99,44,98,42],[100,4,99,2],[101,4,100,2],[101,11,100,9,"raw"],[101,14,100,12],[102,2,101,0],[104,2,103,0],[105,2,104,0],[106,2,105,0],[106,11,105,9,"setRawSanitized"],[106,26,105,24,"setRawSanitized"],[106,27,105,25,"rawRecord"],[106,36,105,34],[106,38,105,36,"columnName"],[106,48,105,46],[106,50,105,48,"value"],[106,55,105,53],[106,57,105,55,"columnSchema"],[106,69,105,67],[106,71,105,69],[107,4,106,2,"_setRaw"],[107,11,106,9],[107,12,106,10,"rawRecord"],[107,21,106,19],[107,23,106,21,"columnName"],[107,33,106,31],[107,35,106,33,"value"],[107,40,106,38],[107,42,106,40,"columnSchema"],[107,54,106,52],[107,55,106,53],[108,2,107,0],[109,2,108,0],[109,11,108,9,"nullValue"],[109,20,108,18,"nullValue"],[109,21,108,19,"columnSchema"],[109,33,108,31],[109,35,108,33],[110,4,109,2],[110,8,109,6],[111,6,110,4,"isOptional"],[111,16,110,14],[111,18,110,16,"isOptional"],[111,28,110,26],[112,6,111,4,"type"],[112,10,111,8],[112,12,111,10,"type"],[113,4,112,2],[113,5,112,3],[113,8,112,6,"columnSchema"],[113,20,112,18],[114,4,113,2],[114,8,113,6,"isOptional"],[114,18,113,16],[114,20,113,18],[115,6,114,4],[115,13,114,11],[115,17,114,15],[116,4,115,2],[116,5,115,3],[116,11,115,9],[116,15,115,13],[116,23,115,21],[116,28,115,26,"type"],[116,32,115,30],[116,34,115,32],[117,6,116,4],[117,13,116,11],[117,15,116,13],[118,4,117,2],[118,5,117,3],[118,11,117,9],[118,15,117,13],[118,23,117,21],[118,28,117,26,"type"],[118,32,117,30],[118,34,117,32],[119,6,118,4],[119,13,118,11],[119,14,118,12],[120,4,119,2],[120,5,119,3],[120,11,119,9],[120,15,119,13],[120,24,119,22],[120,29,119,27,"type"],[120,33,119,31],[120,35,119,33],[121,6,120,4],[121,13,120,11],[121,18,120,16],[122,4,121,2],[123,4,122,2],[123,10,122,8],[123,14,122,12,"Error"],[123,19,122,17],[123,20,122,18],[123,53,122,51],[123,54,122,52,"concat"],[123,60,122,58],[123,61,122,59,"JSON"],[123,65,122,63],[123,66,122,64,"stringify"],[123,75,122,73],[123,76,122,74,"columnSchema"],[123,88,122,86],[123,89,122,87],[123,90,122,88],[123,91,122,89],[124,2,123,0],[125,0,123,1],[125,3]],"functionMap":{"names":["<global>","isValidNumber","_setRaw","isValidStatus","sanitizedRaw","setRawSanitized","nullValue"],"mappings":"AAA;ACoB;CDE;AEG;CF+B;AGC;CHE;AII;CJqC;AKI;CLE;AMC"},"hasCjsExports":true},"type":"js/module"}]}