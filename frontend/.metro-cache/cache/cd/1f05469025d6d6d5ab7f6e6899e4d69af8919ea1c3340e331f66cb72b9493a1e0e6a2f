{"dependencies":[{"name":"../../utils/common","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":5,"column":14,"index":98},"end":{"line":5,"column":43,"index":127}}],"key":"f8rxJKsVH8u9Uvy41cjr6BETN6o=","exportNames":["*"],"imports":1}},{"name":"../encodeMatcher","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":42,"column":18,"index":1247},"end":{"line":42,"column":45,"index":1274}}],"key":"sRJLrlAaT6CROU8aUdxrV/n6mfQ=","exportNames":["*"],"imports":1}},{"name":"./processChangeSet","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":45,"column":23,"index":1354},"end":{"line":45,"column":52,"index":1383}}],"key":"1SRRAMijUng4ECburQAqbTqzsDQ=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  exports.__esModule = true;\n  exports.default = subscribeToSimpleQuery;\n  var _common = require(_dependencyMap[0], \"../../utils/common\");\n  function subscribeToSimpleQuery(query, subscriber,\n  // if true, emissions will always be made on collection change -- this is an internal hack needed by\n  // observeQueryWithColumns\n  alwaysEmit = false) {\n    var matcher = null;\n    var unsubscribed = false;\n    var unsubscribe = null;\n\n    // eslint-disable-next-line prefer-arrow-callback\n    query.collection._fetchQuery(query, function (result) {\n      if (unsubscribed) {\n        return;\n      }\n      if (result.error) {\n        (0, _common.logError)(result.error.toString());\n        return;\n      }\n      var initialRecords = result.value;\n\n      // Send initial matching records\n      var matchingRecords = initialRecords;\n      var emitCopy = function () {\n        return !unsubscribed && subscriber(matchingRecords.slice(0));\n      };\n      emitCopy();\n\n      // Check if emitCopy haven't completed source observable to avoid memory leaks\n      if (unsubscribed) {\n        return;\n      }\n\n      // Observe changes to the collection\n\n      // eslint-disable-next-line prefer-arrow-callback\n      unsubscribe = query.collection.experimentalSubscribe(function (changeSet) {\n        if (!matcher) {\n          matcher = require(_dependencyMap[1], \"../encodeMatcher\").default(query.description);\n        }\n        // $FlowFixMe\n        var shouldEmit = require(_dependencyMap[2], \"./processChangeSet\").default(changeSet, matcher, matchingRecords);\n        if (shouldEmit || alwaysEmit) {\n          emitCopy();\n        }\n      }, {\n        name: 'subscribeToSimpleQuery',\n        query: query,\n        subscriber: subscriber\n      });\n    });\n    return function () {\n      unsubscribed = true;\n      unsubscribe && unsubscribe();\n    };\n  }\n});","lineCount":61,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0,"exports"],[4,9,3,7],[4,10,3,8,"__esModule"],[4,20,3,18],[4,23,3,21],[4,27,3,25],[5,2,4,0,"exports"],[5,9,4,7],[5,10,4,8,"default"],[5,17,4,15],[5,20,4,18,"subscribeToSimpleQuery"],[5,42,4,40],[6,2,5,0],[6,6,5,4,"_common"],[6,13,5,11],[6,16,5,14,"require"],[6,23,5,21],[6,24,5,21,"_dependencyMap"],[6,38,5,21],[6,63,5,42],[6,64,5,43],[7,2,6,0],[7,11,6,9,"subscribeToSimpleQuery"],[7,33,6,31,"subscribeToSimpleQuery"],[7,34,6,32,"query"],[7,39,6,37],[7,41,6,39,"subscriber"],[7,51,6,49],[8,2,7,0],[9,2,8,0],[10,2,9,0,"alwaysEmit"],[10,12,9,10],[10,15,9,13],[10,20,9,18],[10,22,9,20],[11,4,10,2],[11,8,10,6,"matcher"],[11,15,10,13],[11,18,10,16],[11,22,10,20],[12,4,11,2],[12,8,11,6,"unsubscribed"],[12,20,11,18],[12,23,11,21],[12,28,11,26],[13,4,12,2],[13,8,12,6,"unsubscribe"],[13,19,12,17],[13,22,12,20],[13,26,12,24],[15,4,14,2],[16,4,15,2,"query"],[16,9,15,7],[16,10,15,8,"collection"],[16,20,15,18],[16,21,15,19,"_fetchQuery"],[16,32,15,30],[16,33,15,31,"query"],[16,38,15,36],[16,40,15,38],[16,50,15,48,"result"],[16,56,15,54],[16,58,15,56],[17,6,16,4],[17,10,16,8,"unsubscribed"],[17,22,16,20],[17,24,16,22],[18,8,17,6],[19,6,18,4],[20,6,19,4],[20,10,19,8,"result"],[20,16,19,14],[20,17,19,15,"error"],[20,22,19,20],[20,24,19,22],[21,8,20,6],[21,9,20,7],[21,10,20,8],[21,12,20,10,"_common"],[21,19,20,17],[21,20,20,18,"logError"],[21,28,20,26],[21,30,20,28,"result"],[21,36,20,34],[21,37,20,35,"error"],[21,42,20,40],[21,43,20,41,"toString"],[21,51,20,49],[21,52,20,50],[21,53,20,51],[21,54,20,52],[22,8,21,6],[23,6,22,4],[24,6,23,4],[24,10,23,8,"initialRecords"],[24,24,23,22],[24,27,23,25,"result"],[24,33,23,31],[24,34,23,32,"value"],[24,39,23,37],[26,6,25,4],[27,6,26,4],[27,10,26,8,"matchingRecords"],[27,25,26,23],[27,28,26,26,"initialRecords"],[27,42,26,40],[28,6,27,4],[28,10,27,8,"emitCopy"],[28,18,27,16],[28,21,27,19],[28,30,27,19,"emitCopy"],[28,31,27,19],[28,33,27,31],[29,8,28,6],[29,15,28,13],[29,16,28,14,"unsubscribed"],[29,28,28,26],[29,32,28,30,"subscriber"],[29,42,28,40],[29,43,28,41,"matchingRecords"],[29,58,28,56],[29,59,28,57,"slice"],[29,64,28,62],[29,65,28,63],[29,66,28,64],[29,67,28,65],[29,68,28,66],[30,6,29,4],[30,7,29,5],[31,6,30,4,"emitCopy"],[31,14,30,12],[31,15,30,13],[31,16,30,14],[33,6,32,4],[34,6,33,4],[34,10,33,8,"unsubscribed"],[34,22,33,20],[34,24,33,22],[35,8,34,6],[36,6,35,4],[38,6,37,4],[40,6,39,4],[41,6,40,4,"unsubscribe"],[41,17,40,15],[41,20,40,18,"query"],[41,25,40,23],[41,26,40,24,"collection"],[41,36,40,34],[41,37,40,35,"experimentalSubscribe"],[41,58,40,56],[41,59,40,57],[41,69,40,67,"changeSet"],[41,78,40,76],[41,80,40,78],[42,8,41,6],[42,12,41,10],[42,13,41,11,"matcher"],[42,20,41,18],[42,22,41,20],[43,10,42,8,"matcher"],[43,17,42,15],[43,20,42,18,"require"],[43,27,42,25],[43,28,42,25,"_dependencyMap"],[43,42,42,25],[43,65,42,44],[43,66,42,45],[43,67,42,46,"default"],[43,74,42,53],[43,75,42,54,"query"],[43,80,42,59],[43,81,42,60,"description"],[43,92,42,71],[43,93,42,72],[44,8,43,6],[45,8,44,6],[46,8,45,6],[46,12,45,10,"shouldEmit"],[46,22,45,20],[46,25,45,23,"require"],[46,32,45,30],[46,33,45,30,"_dependencyMap"],[46,47,45,30],[46,72,45,51],[46,73,45,52],[46,74,45,53,"default"],[46,81,45,60],[46,82,45,61,"changeSet"],[46,91,45,70],[46,93,45,72,"matcher"],[46,100,45,79],[46,102,45,81,"matchingRecords"],[46,117,45,96],[46,118,45,97],[47,8,46,6],[47,12,46,10,"shouldEmit"],[47,22,46,20],[47,26,46,24,"alwaysEmit"],[47,36,46,34],[47,38,46,36],[48,10,47,8,"emitCopy"],[48,18,47,16],[48,19,47,17],[48,20,47,18],[49,8,48,6],[50,6,49,4],[50,7,49,5],[50,9,49,7],[51,8,50,6,"name"],[51,12,50,10],[51,14,50,12],[51,38,50,36],[52,8,51,6,"query"],[52,13,51,11],[52,15,51,13,"query"],[52,20,51,18],[53,8,52,6,"subscriber"],[53,18,52,16],[53,20,52,18,"subscriber"],[54,6,53,4],[54,7,53,5],[54,8,53,6],[55,4,54,2],[55,5,54,3],[55,6,54,4],[56,4,55,2],[56,11,55,9],[56,23,55,21],[57,6,56,4,"unsubscribed"],[57,18,56,16],[57,21,56,19],[57,25,56,23],[58,6,57,4,"unsubscribe"],[58,17,57,15],[58,21,57,19,"unsubscribe"],[58,32,57,30],[58,33,57,31],[58,34,57,32],[59,4,58,2],[59,5,58,3],[60,2,59,0],[61,0,59,1],[61,3]],"functionMap":{"names":["<global>","subscribeToSimpleQuery","query.collection._fetchQuery$argument_1","emitCopy","query.collection.experimentalSubscribe$argument_0","<anonymous>"],"mappings":"AAA;ACK;sCCS;mBCY;KDE;yDEW;KFS;GDK;SIC;GJG"},"hasCjsExports":true},"type":"js/module"}]}