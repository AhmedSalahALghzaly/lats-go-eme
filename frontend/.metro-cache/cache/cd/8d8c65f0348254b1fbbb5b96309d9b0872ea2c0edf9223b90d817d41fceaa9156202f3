{"dependencies":[{"name":"./worker/loki.worker","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":7,"column":24,"index":152},"end":{"line":7,"column":55,"index":183}}],"key":"TTeX3BP+GT2W9Q9Jc7GBQtFpoXM=","exportNames":["*"],"imports":1}},{"name":"./worker/synchronousWorker","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":10,"column":30,"index":251},"end":{"line":10,"column":67,"index":288}}],"key":"GAvoztH2cL6+xfk6i/OAUi4Ha1g=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  exports.__esModule = true;\n  exports.default = void 0;\n  function createWorker(useWebWorker) {\n    if (useWebWorker) {\n      var LokiWebWorker = require(_dependencyMap[0], \"./worker/loki.worker\");\n      return new LokiWebWorker();\n    }\n    var LokiSynchronousWorker = require(_dependencyMap[1], \"./worker/synchronousWorker\").default;\n    return new LokiSynchronousWorker();\n  }\n  var _actionId = 0;\n  function nextActionId() {\n    _actionId += 1;\n    return _actionId;\n  }\n  var LokiDispatcher = exports.default = /*#__PURE__*/function () {\n    function LokiDispatcher(useWebWorker) {\n      var _this = this;\n      this._pendingCalls = [];\n      this._worker = createWorker(useWebWorker);\n      this._worker.onmessage = function ({\n        data: data\n      }) {\n        var {\n          result: result,\n          id: responseId\n        } = data;\n        var {\n          callback: callback,\n          id: id\n        } = _this._pendingCalls.shift();\n\n        // sanity check\n        if (id !== responseId) {\n          callback({\n            error: new Error('Loki worker responses are out of order')\n          });\n          return;\n        }\n        callback(result);\n      };\n    }\n\n    // TODO: `any` return should be `WorkerResponsePayload`\n    var _proto = LokiDispatcher.prototype;\n    _proto.call = function (type, payload = [], callback = function () {},\n    // NOTE: This are used when not using web workers (otherwise, the data naturally is just copied)\n    cloneMethod = 'immutable', returnCloneMethod = 'immutable') {\n      var id = nextActionId();\n      this._pendingCalls.push({\n        callback: callback,\n        id: id\n      });\n      this._worker.postMessage({\n        id: id,\n        type: type,\n        payload: payload,\n        cloneMethod: cloneMethod,\n        returnCloneMethod: returnCloneMethod\n      });\n    };\n    return LokiDispatcher;\n  }();\n});","lineCount":67,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0,"exports"],[4,9,3,7],[4,10,3,8,"__esModule"],[4,20,3,18],[4,23,3,21],[4,27,3,25],[5,2,4,0,"exports"],[5,9,4,7],[5,10,4,8,"default"],[5,17,4,15],[5,20,4,18],[5,25,4,23],[5,26,4,24],[6,2,5,0],[6,11,5,9,"createWorker"],[6,23,5,21,"createWorker"],[6,24,5,22,"useWebWorker"],[6,36,5,34],[6,38,5,36],[7,4,6,2],[7,8,6,6,"useWebWorker"],[7,20,6,18],[7,22,6,20],[8,6,7,4],[8,10,7,8,"LokiWebWorker"],[8,23,7,21],[8,26,7,24,"require"],[8,33,7,31],[8,34,7,31,"_dependencyMap"],[8,48,7,31],[8,75,7,54],[8,76,7,55],[9,6,8,4],[9,13,8,11],[9,17,8,15,"LokiWebWorker"],[9,30,8,28],[9,31,8,29],[9,32,8,30],[10,4,9,2],[11,4,10,2],[11,8,10,6,"LokiSynchronousWorker"],[11,29,10,27],[11,32,10,30,"require"],[11,39,10,37],[11,40,10,37,"_dependencyMap"],[11,54,10,37],[11,87,10,66],[11,88,10,67],[11,89,10,68,"default"],[11,96,10,75],[12,4,11,2],[12,11,11,9],[12,15,11,13,"LokiSynchronousWorker"],[12,36,11,34],[12,37,11,35],[12,38,11,36],[13,2,12,0],[14,2,13,0],[14,6,13,4,"_actionId"],[14,15,13,13],[14,18,13,16],[14,19,13,17],[15,2,14,0],[15,11,14,9,"nextActionId"],[15,23,14,21,"nextActionId"],[15,24,14,21],[15,26,14,24],[16,4,15,2,"_actionId"],[16,13,15,11],[16,17,15,15],[16,18,15,16],[17,4,16,2],[17,11,16,9,"_actionId"],[17,20,16,18],[18,2,17,0],[19,2,18,0],[19,6,18,4,"LokiDispatcher"],[19,20,18,18],[19,23,18,21,"exports"],[19,30,18,28],[19,31,18,29,"default"],[19,38,18,36],[19,41,18,39],[19,54,18,52],[19,66,18,64],[20,4,19,2],[20,13,19,11,"LokiDispatcher"],[20,27,19,25,"LokiDispatcher"],[20,28,19,26,"useWebWorker"],[20,40,19,38],[20,42,19,40],[21,6,20,4],[21,10,20,8,"_this"],[21,15,20,13],[21,18,20,16],[21,22,20,20],[22,6,21,4],[22,10,21,8],[22,11,21,9,"_pendingCalls"],[22,24,21,22],[22,27,21,25],[22,29,21,27],[23,6,22,4],[23,10,22,8],[23,11,22,9,"_worker"],[23,18,22,16],[23,21,22,19,"createWorker"],[23,33,22,31],[23,34,22,32,"useWebWorker"],[23,46,22,44],[23,47,22,45],[24,6,23,4],[24,10,23,8],[24,11,23,9,"_worker"],[24,18,23,16],[24,19,23,17,"onmessage"],[24,28,23,26],[24,31,23,29],[24,41,23,39],[25,8,24,6,"data"],[25,12,24,10],[25,14,24,12,"data"],[26,6,25,4],[26,7,25,5],[26,9,25,7],[27,8,26,6],[27,12,26,10],[28,10,27,8,"result"],[28,16,27,14],[28,18,27,16,"result"],[28,24,27,22],[29,10,28,8,"id"],[29,12,28,10],[29,14,28,12,"responseId"],[30,8,29,6],[30,9,29,7],[30,12,29,10,"data"],[30,16,29,14],[31,8,30,6],[31,12,30,10],[32,10,31,8,"callback"],[32,18,31,16],[32,20,31,18,"callback"],[32,28,31,26],[33,10,32,8,"id"],[33,12,32,10],[33,14,32,12,"id"],[34,8,33,6],[34,9,33,7],[34,12,33,10,"_this"],[34,17,33,15],[34,18,33,16,"_pendingCalls"],[34,31,33,29],[34,32,33,30,"shift"],[34,37,33,35],[34,38,33,36],[34,39,33,37],[36,8,35,6],[37,8,36,6],[37,12,36,10,"id"],[37,14,36,12],[37,19,36,17,"responseId"],[37,29,36,27],[37,31,36,29],[38,10,37,8,"callback"],[38,18,37,16],[38,19,37,17],[39,12,38,10,"error"],[39,17,38,15],[39,19,38,17],[39,23,38,21,"Error"],[39,28,38,26],[39,29,38,27],[39,69,38,67],[40,10,39,8],[40,11,39,9],[40,12,39,10],[41,10,40,8],[42,8,41,6],[43,8,42,6,"callback"],[43,16,42,14],[43,17,42,15,"result"],[43,23,42,21],[43,24,42,22],[44,6,43,4],[44,7,43,5],[45,4,44,2],[47,4,46,2],[48,4,47,2],[48,8,47,6,"_proto"],[48,14,47,12],[48,17,47,15,"LokiDispatcher"],[48,31,47,29],[48,32,47,30,"prototype"],[48,41,47,39],[49,4,48,2,"_proto"],[49,10,48,8],[49,11,48,9,"call"],[49,15,48,13],[49,18,48,16],[49,28,48,26,"type"],[49,32,48,30],[49,34,48,32,"payload"],[49,41,48,39],[49,44,48,42],[49,46,48,44],[49,48,48,46,"callback"],[49,56,48,54],[49,59,48,57],[49,68,48,57,"callback"],[49,69,48,57],[49,71,48,69],[49,72,48,70],[49,73,48,71],[50,4,49,2],[51,4,50,2,"cloneMethod"],[51,15,50,13],[51,18,50,16],[51,29,50,27],[51,31,50,29,"returnCloneMethod"],[51,48,50,46],[51,51,50,49],[51,62,50,60],[51,64,50,62],[52,6,51,4],[52,10,51,8,"id"],[52,12,51,10],[52,15,51,13,"nextActionId"],[52,27,51,25],[52,28,51,26],[52,29,51,27],[53,6,52,4],[53,10,52,8],[53,11,52,9,"_pendingCalls"],[53,24,52,22],[53,25,52,23,"push"],[53,29,52,27],[53,30,52,28],[54,8,53,6,"callback"],[54,16,53,14],[54,18,53,16,"callback"],[54,26,53,24],[55,8,54,6,"id"],[55,10,54,8],[55,12,54,10,"id"],[56,6,55,4],[56,7,55,5],[56,8,55,6],[57,6,56,4],[57,10,56,8],[57,11,56,9,"_worker"],[57,18,56,16],[57,19,56,17,"postMessage"],[57,30,56,28],[57,31,56,29],[58,8,57,6,"id"],[58,10,57,8],[58,12,57,10,"id"],[58,14,57,12],[59,8,58,6,"type"],[59,12,58,10],[59,14,58,12,"type"],[59,18,58,16],[60,8,59,6,"payload"],[60,15,59,13],[60,17,59,15,"payload"],[60,24,59,22],[61,8,60,6,"cloneMethod"],[61,19,60,17],[61,21,60,19,"cloneMethod"],[61,32,60,30],[62,8,61,6,"returnCloneMethod"],[62,25,61,23],[62,27,61,25,"returnCloneMethod"],[63,6,62,4],[63,7,62,5],[63,8,62,6],[64,4,63,2],[64,5,63,3],[65,4,64,2],[65,11,64,9,"LokiDispatcher"],[65,25,64,23],[66,2,65,0],[66,3,65,1],[66,4,65,2],[66,5,65,3],[67,0,65,4],[67,3]],"functionMap":{"names":["<global>","createWorker","nextActionId","<anonymous>","LokiDispatcher","_worker.onmessage","_proto.call"],"mappings":"AAA;ACI;CDO;AEE;CFG;oDGC;ECC;6BCI;KDoB;GDC;gBGI,yCH,cG;GHe;CHE"},"hasCjsExports":true},"type":"js/module"}]}