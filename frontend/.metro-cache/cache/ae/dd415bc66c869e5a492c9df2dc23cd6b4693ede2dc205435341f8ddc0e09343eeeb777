{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":29,"index":44},"end":{"line":3,"column":84,"index":99}}],"key":"kslwqCIsh6ew+I1KeA1rlVRjsAk=","exportNames":["*"],"imports":1}},{"name":"./encodeQuery","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":7,"column":42,"index":244},"end":{"line":7,"column":66,"index":268}}],"key":"Vb2mqFawEJgX2CBFzkfEIWChDJQ=","exportNames":["*"],"imports":1}},{"name":"./performJoins","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":8,"column":43,"index":314},"end":{"line":8,"column":68,"index":339}}],"key":"kUYLdibenx2lYjaibempaj6dWrU=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  exports.__esModule = true;\n  exports.executeCount = executeCount;\n  exports.executeQuery = executeQuery;\n  var _encodeQuery = _interopRequireDefault(require(_dependencyMap[1], \"./encodeQuery\"));\n  var _performJoins = _interopRequireDefault(require(_dependencyMap[2], \"./performJoins\"));\n  // Finds IDs of matching records on foreign table\n  function performJoin(join, loki) {\n    var {\n      table: table,\n      query: query\n    } = join;\n    var collection = loki.getCollection(table).chain();\n    var records = collection.find(query).data();\n    return records;\n  }\n  function performQuery(query, loki) {\n    // Step one: perform all inner queries (JOINs) to get the single table query\n    var lokiQuery = (0, _encodeQuery.default)(query);\n    var mainQuery = (0, _performJoins.default)(lokiQuery, function (join) {\n      return performJoin(join, loki);\n    });\n\n    // Step two: fetch all records matching query\n    var collection = loki.getCollection(query.table).chain();\n    var resultset = collection.find(mainQuery);\n\n    // Step three: sort, skip, take\n    var {\n      sortBy: sortBy,\n      take: take,\n      skip: skip\n    } = query.description;\n    if (sortBy.length) {\n      resultset = resultset.compoundsort(sortBy.map(function ({\n        sortColumn: sortColumn,\n        sortOrder: sortOrder\n      }) {\n        return [sortColumn, 'desc' === sortOrder];\n      }));\n    }\n    if (skip) {\n      resultset = resultset.offset(skip);\n    }\n    if (take) {\n      resultset = resultset.limit(take);\n    }\n    return resultset;\n  }\n  function executeQuery(query, loki) {\n    var {\n      lokiTransform: lokiTransform\n    } = query.description;\n    var results = performQuery(query, loki).data();\n    if (lokiTransform) {\n      return lokiTransform(results, loki);\n    }\n    return results;\n  }\n  function executeCount(query, loki) {\n    var {\n      lokiTransform: lokiTransform\n    } = query.description;\n    var resultset = performQuery(query, loki);\n    if (lokiTransform) {\n      var records = lokiTransform(resultset.data(), loki);\n      return records.length;\n    }\n    return resultset.count();\n  }\n});","lineCount":74,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0],[4,6,3,4,"_interopRequireDefault"],[4,28,3,26],[4,31,3,29,"require"],[4,38,3,36],[4,39,3,36,"_dependencyMap"],[4,53,3,36],[4,104,3,83],[4,105,3,84],[5,2,4,0,"exports"],[5,9,4,7],[5,10,4,8,"__esModule"],[5,20,4,18],[5,23,4,21],[5,27,4,25],[6,2,5,0,"exports"],[6,9,5,7],[6,10,5,8,"executeCount"],[6,22,5,20],[6,25,5,23,"executeCount"],[6,37,5,35],[7,2,6,0,"exports"],[7,9,6,7],[7,10,6,8,"executeQuery"],[7,22,6,20],[7,25,6,23,"executeQuery"],[7,37,6,35],[8,2,7,0],[8,6,7,4,"_encodeQuery"],[8,18,7,16],[8,21,7,19,"_interopRequireDefault"],[8,43,7,41],[8,44,7,42,"require"],[8,51,7,49],[8,52,7,49,"_dependencyMap"],[8,66,7,49],[8,86,7,65],[8,87,7,66],[8,88,7,67],[9,2,8,0],[9,6,8,4,"_performJoins"],[9,19,8,17],[9,22,8,20,"_interopRequireDefault"],[9,44,8,42],[9,45,8,43,"require"],[9,52,8,50],[9,53,8,50,"_dependencyMap"],[9,67,8,50],[9,88,8,67],[9,89,8,68],[9,90,8,69],[10,2,9,0],[11,2,10,0],[11,11,10,9,"performJoin"],[11,22,10,20,"performJoin"],[11,23,10,21,"join"],[11,27,10,25],[11,29,10,27,"loki"],[11,33,10,31],[11,35,10,33],[12,4,11,2],[12,8,11,6],[13,6,12,4,"table"],[13,11,12,9],[13,13,12,11,"table"],[13,18,12,16],[14,6,13,4,"query"],[14,11,13,9],[14,13,13,11,"query"],[15,4,14,2],[15,5,14,3],[15,8,14,6,"join"],[15,12,14,10],[16,4,15,2],[16,8,15,6,"collection"],[16,18,15,16],[16,21,15,19,"loki"],[16,25,15,23],[16,26,15,24,"getCollection"],[16,39,15,37],[16,40,15,38,"table"],[16,45,15,43],[16,46,15,44],[16,47,15,45,"chain"],[16,52,15,50],[16,53,15,51],[16,54,15,52],[17,4,16,2],[17,8,16,6,"records"],[17,15,16,13],[17,18,16,16,"collection"],[17,28,16,26],[17,29,16,27,"find"],[17,33,16,31],[17,34,16,32,"query"],[17,39,16,37],[17,40,16,38],[17,41,16,39,"data"],[17,45,16,43],[17,46,16,44],[17,47,16,45],[18,4,17,2],[18,11,17,9,"records"],[18,18,17,16],[19,2,18,0],[20,2,19,0],[20,11,19,9,"performQuery"],[20,23,19,21,"performQuery"],[20,24,19,22,"query"],[20,29,19,27],[20,31,19,29,"loki"],[20,35,19,33],[20,37,19,35],[21,4,20,2],[22,4,21,2],[22,8,21,6,"lokiQuery"],[22,17,21,15],[22,20,21,18],[22,21,21,19],[22,22,21,20],[22,24,21,22,"_encodeQuery"],[22,36,21,34],[22,37,21,35,"default"],[22,44,21,42],[22,46,21,44,"query"],[22,51,21,49],[22,52,21,50],[23,4,22,2],[23,8,22,6,"mainQuery"],[23,17,22,15],[23,20,22,18],[23,21,22,19],[23,22,22,20],[23,24,22,22,"_performJoins"],[23,37,22,35],[23,38,22,36,"default"],[23,45,22,43],[23,47,22,45,"lokiQuery"],[23,56,22,54],[23,58,22,56],[23,68,22,66,"join"],[23,72,22,70],[23,74,22,72],[24,6,23,4],[24,13,23,11,"performJoin"],[24,24,23,22],[24,25,23,23,"join"],[24,29,23,27],[24,31,23,29,"loki"],[24,35,23,33],[24,36,23,34],[25,4,24,2],[25,5,24,3],[25,6,24,4],[27,4,26,2],[28,4,27,2],[28,8,27,6,"collection"],[28,18,27,16],[28,21,27,19,"loki"],[28,25,27,23],[28,26,27,24,"getCollection"],[28,39,27,37],[28,40,27,38,"query"],[28,45,27,43],[28,46,27,44,"table"],[28,51,27,49],[28,52,27,50],[28,53,27,51,"chain"],[28,58,27,56],[28,59,27,57],[28,60,27,58],[29,4,28,2],[29,8,28,6,"resultset"],[29,17,28,15],[29,20,28,18,"collection"],[29,30,28,28],[29,31,28,29,"find"],[29,35,28,33],[29,36,28,34,"mainQuery"],[29,45,28,43],[29,46,28,44],[31,4,30,2],[32,4,31,2],[32,8,31,6],[33,6,32,4,"sortBy"],[33,12,32,10],[33,14,32,12,"sortBy"],[33,20,32,18],[34,6,33,4,"take"],[34,10,33,8],[34,12,33,10,"take"],[34,16,33,14],[35,6,34,4,"skip"],[35,10,34,8],[35,12,34,10,"skip"],[36,4,35,2],[36,5,35,3],[36,8,35,6,"query"],[36,13,35,11],[36,14,35,12,"description"],[36,25,35,23],[37,4,36,2],[37,8,36,6,"sortBy"],[37,14,36,12],[37,15,36,13,"length"],[37,21,36,19],[37,23,36,21],[38,6,37,4,"resultset"],[38,15,37,13],[38,18,37,16,"resultset"],[38,27,37,25],[38,28,37,26,"compoundsort"],[38,40,37,38],[38,41,37,39,"sortBy"],[38,47,37,45],[38,48,37,46,"map"],[38,51,37,49],[38,52,37,50],[38,62,37,60],[39,8,38,6,"sortColumn"],[39,18,38,16],[39,20,38,18,"sortColumn"],[39,30,38,28],[40,8,39,6,"sortOrder"],[40,17,39,15],[40,19,39,17,"sortOrder"],[41,6,40,4],[41,7,40,5],[41,9,40,7],[42,8,41,6],[42,15,41,13],[42,16,41,14,"sortColumn"],[42,26,41,24],[42,28,41,26],[42,34,41,32],[42,39,41,37,"sortOrder"],[42,48,41,46],[42,49,41,47],[43,6,42,4],[43,7,42,5],[43,8,42,6],[43,9,42,7],[44,4,43,2],[45,4,44,2],[45,8,44,6,"skip"],[45,12,44,10],[45,14,44,12],[46,6,45,4,"resultset"],[46,15,45,13],[46,18,45,16,"resultset"],[46,27,45,25],[46,28,45,26,"offset"],[46,34,45,32],[46,35,45,33,"skip"],[46,39,45,37],[46,40,45,38],[47,4,46,2],[48,4,47,2],[48,8,47,6,"take"],[48,12,47,10],[48,14,47,12],[49,6,48,4,"resultset"],[49,15,48,13],[49,18,48,16,"resultset"],[49,27,48,25],[49,28,48,26,"limit"],[49,33,48,31],[49,34,48,32,"take"],[49,38,48,36],[49,39,48,37],[50,4,49,2],[51,4,50,2],[51,11,50,9,"resultset"],[51,20,50,18],[52,2,51,0],[53,2,52,0],[53,11,52,9,"executeQuery"],[53,23,52,21,"executeQuery"],[53,24,52,22,"query"],[53,29,52,27],[53,31,52,29,"loki"],[53,35,52,33],[53,37,52,35],[54,4,53,2],[54,8,53,6],[55,6,54,4,"lokiTransform"],[55,19,54,17],[55,21,54,19,"lokiTransform"],[56,4,55,2],[56,5,55,3],[56,8,55,6,"query"],[56,13,55,11],[56,14,55,12,"description"],[56,25,55,23],[57,4,56,2],[57,8,56,6,"results"],[57,15,56,13],[57,18,56,16,"performQuery"],[57,30,56,28],[57,31,56,29,"query"],[57,36,56,34],[57,38,56,36,"loki"],[57,42,56,40],[57,43,56,41],[57,44,56,42,"data"],[57,48,56,46],[57,49,56,47],[57,50,56,48],[58,4,57,2],[58,8,57,6,"lokiTransform"],[58,21,57,19],[58,23,57,21],[59,6,58,4],[59,13,58,11,"lokiTransform"],[59,26,58,24],[59,27,58,25,"results"],[59,34,58,32],[59,36,58,34,"loki"],[59,40,58,38],[59,41,58,39],[60,4,59,2],[61,4,60,2],[61,11,60,9,"results"],[61,18,60,16],[62,2,61,0],[63,2,62,0],[63,11,62,9,"executeCount"],[63,23,62,21,"executeCount"],[63,24,62,22,"query"],[63,29,62,27],[63,31,62,29,"loki"],[63,35,62,33],[63,37,62,35],[64,4,63,2],[64,8,63,6],[65,6,64,4,"lokiTransform"],[65,19,64,17],[65,21,64,19,"lokiTransform"],[66,4,65,2],[66,5,65,3],[66,8,65,6,"query"],[66,13,65,11],[66,14,65,12,"description"],[66,25,65,23],[67,4,66,2],[67,8,66,6,"resultset"],[67,17,66,15],[67,20,66,18,"performQuery"],[67,32,66,30],[67,33,66,31,"query"],[67,38,66,36],[67,40,66,38,"loki"],[67,44,66,42],[67,45,66,43],[68,4,67,2],[68,8,67,6,"lokiTransform"],[68,21,67,19],[68,23,67,21],[69,6,68,4],[69,10,68,8,"records"],[69,17,68,15],[69,20,68,18,"lokiTransform"],[69,33,68,31],[69,34,68,32,"resultset"],[69,43,68,41],[69,44,68,42,"data"],[69,48,68,46],[69,49,68,47],[69,50,68,48],[69,52,68,50,"loki"],[69,56,68,54],[69,57,68,55],[70,6,69,4],[70,13,69,11,"records"],[70,20,69,18],[70,21,69,19,"length"],[70,27,69,25],[71,4,70,2],[72,4,71,2],[72,11,71,9,"resultset"],[72,20,71,18],[72,21,71,19,"count"],[72,26,71,24],[72,27,71,25],[72,28,71,26],[73,2,72,0],[74,0,72,1],[74,3]],"functionMap":{"names":["<global>","performJoin","performQuery","<anonymous>","sortBy.map$argument_0","executeQuery","executeCount"],"mappings":"AAA;ACS;CDQ;AEC;wDCG;GDE;kDEa;KFK;CFS;AKC;CLS;AMC"},"hasCjsExports":true},"type":"js/module"}]}