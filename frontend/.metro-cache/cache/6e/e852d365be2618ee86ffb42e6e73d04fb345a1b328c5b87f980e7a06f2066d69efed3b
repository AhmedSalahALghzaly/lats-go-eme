{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":29,"index":44},"end":{"line":3,"column":84,"index":99}}],"key":"kslwqCIsh6ew+I1KeA1rlVRjsAk=","exportNames":["*"],"imports":1}},{"name":"../../utils/common","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":6,"column":14,"index":187},"end":{"line":6,"column":43,"index":216}}],"key":"f8rxJKsVH8u9Uvy41cjr6BETN6o=","exportNames":["*"],"imports":1}},{"name":"../../utils/fp/identicalArrays","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":7,"column":46,"index":264},"end":{"line":7,"column":87,"index":305}}],"key":"kkcIWN0yjzDpDf8rp16crxlPC6A=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  exports.__esModule = true;\n  exports.default = subscribeToQueryReloading;\n  var _common = require(_dependencyMap[1], \"../../utils/common\");\n  var _identicalArrays = _interopRequireDefault(require(_dependencyMap[2], \"../../utils/fp/identicalArrays\"));\n  // Produces an observable version of a query by re-querying the database\n  // when any change occurs in any of the relevant Stores.\n  // This is inefficient for simple queries, but necessary for complex queries\n  function subscribeToQueryReloading(query, subscriber) {\n    var shouldEmitStatus = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    var collection = query.collection;\n    var previousRecords = null;\n    var unsubscribed = false;\n    function reloadingObserverFetch() {\n      if (shouldEmitStatus) {\n        unsubscribed || subscriber(false);\n      }\n      collection._fetchQuery(query, function (result) {\n        if (result.error) {\n          (0, _common.logError)(result.error.toString());\n          return;\n        }\n        var records = result.value;\n        var shouldEmit = !unsubscribed && (shouldEmitStatus || !previousRecords || !(0, _identicalArrays.default)(records, previousRecords));\n        previousRecords = records;\n        shouldEmit && subscriber(records);\n      });\n    }\n    var unsubscribe = collection.database.experimentalSubscribe(query.allTables, reloadingObserverFetch, {\n      name: 'subscribeToQueryReloading observation',\n      query: query,\n      subscriber: subscriber\n    });\n    reloadingObserverFetch();\n    return function () {\n      unsubscribed = true;\n      unsubscribe();\n    };\n  }\n});","lineCount":43,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0],[4,6,3,4,"_interopRequireDefault"],[4,28,3,26],[4,31,3,29,"require"],[4,38,3,36],[4,39,3,36,"_dependencyMap"],[4,53,3,36],[4,104,3,83],[4,105,3,84],[5,2,4,0,"exports"],[5,9,4,7],[5,10,4,8,"__esModule"],[5,20,4,18],[5,23,4,21],[5,27,4,25],[6,2,5,0,"exports"],[6,9,5,7],[6,10,5,8,"default"],[6,17,5,15],[6,20,5,18,"subscribeToQueryReloading"],[6,45,5,43],[7,2,6,0],[7,6,6,4,"_common"],[7,13,6,11],[7,16,6,14,"require"],[7,23,6,21],[7,24,6,21,"_dependencyMap"],[7,38,6,21],[7,63,6,42],[7,64,6,43],[8,2,7,0],[8,6,7,4,"_identicalArrays"],[8,22,7,20],[8,25,7,23,"_interopRequireDefault"],[8,47,7,45],[8,48,7,46,"require"],[8,55,7,53],[8,56,7,53,"_dependencyMap"],[8,70,7,53],[8,107,7,86],[8,108,7,87],[8,109,7,88],[9,2,8,0],[10,2,9,0],[11,2,10,0],[12,2,11,0],[12,11,11,9,"subscribeToQueryReloading"],[12,36,11,34,"subscribeToQueryReloading"],[12,37,11,35,"query"],[12,42,11,40],[12,44,11,42,"subscriber"],[12,54,11,52],[12,56,14,26],[13,4,14,26],[13,8,14,0,"shouldEmitStatus"],[13,24,14,16],[13,27,14,16,"arguments"],[13,36,14,16],[13,37,14,16,"length"],[13,43,14,16],[13,51,14,16,"arguments"],[13,60,14,16],[13,68,14,16,"undefined"],[13,77,14,16],[13,80,14,16,"arguments"],[13,89,14,16],[13,95,14,19],[13,100,14,24],[14,4,15,2],[14,8,16,16,"collection"],[14,18,16,26],[14,21,17,6,"query"],[14,26,17,11],[14,27,16,4,"collection"],[14,37,16,14],[15,4,18,2],[15,8,18,6,"previousRecords"],[15,23,18,21],[15,26,18,24],[15,30,18,28],[16,4,19,2],[16,8,19,6,"unsubscribed"],[16,20,19,18],[16,23,19,21],[16,28,19,26],[17,4,20,2],[17,13,20,11,"reloadingObserverFetch"],[17,35,20,33,"reloadingObserverFetch"],[17,36,20,33],[17,38,20,36],[18,6,21,4],[18,10,21,8,"shouldEmitStatus"],[18,26,21,24],[18,28,21,26],[19,8,22,6,"unsubscribed"],[19,20,22,18],[19,24,22,22,"subscriber"],[19,34,22,32],[19,35,22,33],[19,40,22,38],[19,41,22,39],[20,6,23,4],[21,6,24,4,"collection"],[21,16,24,14],[21,17,24,15,"_fetchQuery"],[21,28,24,26],[21,29,24,27,"query"],[21,34,24,32],[21,36,24,34],[21,46,24,44,"result"],[21,52,24,50],[21,54,24,52],[22,8,25,6],[22,12,25,10,"result"],[22,18,25,16],[22,19,25,17,"error"],[22,24,25,22],[22,26,25,24],[23,10,26,8],[23,11,26,9],[23,12,26,10],[23,14,26,12,"_common"],[23,21,26,19],[23,22,26,20,"logError"],[23,30,26,28],[23,32,26,30,"result"],[23,38,26,36],[23,39,26,37,"error"],[23,44,26,42],[23,45,26,43,"toString"],[23,53,26,51],[23,54,26,52],[23,55,26,53],[23,56,26,54],[24,10,27,8],[25,8,28,6],[26,8,29,6],[26,12,29,10,"records"],[26,19,29,17],[26,22,29,20,"result"],[26,28,29,26],[26,29,29,27,"value"],[26,34,29,32],[27,8,30,6],[27,12,30,10,"shouldEmit"],[27,22,30,20],[27,25,30,23],[27,26,30,24,"unsubscribed"],[27,38,30,36],[27,43,30,41,"shouldEmitStatus"],[27,59,30,57],[27,63,30,61],[27,64,30,62,"previousRecords"],[27,79,30,77],[27,83,30,81],[27,84,30,82],[27,85,30,83],[27,86,30,84],[27,88,30,86,"_identicalArrays"],[27,104,30,102],[27,105,30,103,"default"],[27,112,30,110],[27,114,30,112,"records"],[27,121,30,119],[27,123,30,121,"previousRecords"],[27,138,30,136],[27,139,30,137],[27,140,30,138],[28,8,31,6,"previousRecords"],[28,23,31,21],[28,26,31,24,"records"],[28,33,31,31],[29,8,32,6,"shouldEmit"],[29,18,32,16],[29,22,32,20,"subscriber"],[29,32,32,30],[29,33,32,31,"records"],[29,40,32,38],[29,41,32,39],[30,6,33,4],[30,7,33,5],[30,8,33,6],[31,4,34,2],[32,4,35,2],[32,8,35,6,"unsubscribe"],[32,19,35,17],[32,22,35,20,"collection"],[32,32,35,30],[32,33,35,31,"database"],[32,41,35,39],[32,42,35,40,"experimentalSubscribe"],[32,63,35,61],[32,64,35,62,"query"],[32,69,35,67],[32,70,35,68,"allTables"],[32,79,35,77],[32,81,35,79,"reloadingObserverFetch"],[32,103,35,101],[32,105,35,103],[33,6,36,4,"name"],[33,10,36,8],[33,12,36,10],[33,51,36,49],[34,6,37,4,"query"],[34,11,37,9],[34,13,37,11,"query"],[34,18,37,16],[35,6,38,4,"subscriber"],[35,16,38,14],[35,18,38,16,"subscriber"],[36,4,39,2],[36,5,39,3],[36,6,39,4],[37,4,40,2,"reloadingObserverFetch"],[37,26,40,24],[37,27,40,25],[37,28,40,26],[38,4,41,2],[38,11,41,9],[38,23,41,21],[39,6,42,4,"unsubscribed"],[39,18,42,16],[39,21,42,19],[39,25,42,23],[40,6,43,4,"unsubscribe"],[40,17,43,15],[40,18,43,16],[40,19,43,17],[41,4,44,2],[41,5,44,3],[42,2,45,0],[43,0,45,1],[43,3]],"functionMap":{"names":["<global>","subscribeToQueryReloading","reloadingObserverFetch","collection._fetchQuery$argument_1","<anonymous>"],"mappings":"AAA;ACU;ECS;kCCI;KDS;GDC;SGO;GHG"},"hasCjsExports":true},"type":"js/module"}]}